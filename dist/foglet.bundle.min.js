!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("foglet",[],e):"object"==typeof exports?exports.foglet=e():t.foglet=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=168)}([function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(r){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}(e=t.exports=n(149)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&"%c"===t&&(s=++i)}),t.splice(s,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(this,n(7))},function(t,e,n){(function(t,n){var r="__lodash_hash_undefined__",i=9007199254740991,s="[object Arguments]",o="[object AsyncFunction]",a="[object Function]",c="[object GeneratorFunction]",h="[object Null]",u="[object Object]",l="[object Proxy]",f="[object Undefined]",p=/^\[object .+?Constructor\]$/,d=/^(?:0|[1-9]\d*)$/,g={};g["[object Float32Array]"]=g["[object Float64Array]"]=g["[object Int8Array]"]=g["[object Int16Array]"]=g["[object Int32Array]"]=g["[object Uint8Array]"]=g["[object Uint8ClampedArray]"]=g["[object Uint16Array]"]=g["[object Uint32Array]"]=!0,g[s]=g["[object Array]"]=g["[object ArrayBuffer]"]=g["[object Boolean]"]=g["[object DataView]"]=g["[object Date]"]=g["[object Error]"]=g[a]=g["[object Map]"]=g["[object Number]"]=g[u]=g["[object RegExp]"]=g["[object Set]"]=g["[object String]"]=g["[object WeakMap]"]=!1;var y="object"==typeof t&&t&&t.Object===Object&&t,m="object"==typeof self&&self&&self.Object===Object&&self,v=y||m||Function("return this")(),_="object"==typeof e&&e&&!e.nodeType&&e,w=_&&"object"==typeof n&&n&&!n.nodeType&&n,b=w&&w.exports===_,E=b&&y.process,k=function(){try{return E&&E.binding&&E.binding("util")}catch(t){}}(),S=k&&k.isTypedArray;function x(t,e){return"__proto__"==e?void 0:t[e]}var A,R,C,T=Array.prototype,P=Function.prototype,M=Object.prototype,I=v["__core-js_shared__"],B=P.toString,O=M.hasOwnProperty,j=(A=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||""))?"Symbol(src)_1."+A:"",N=M.toString,D=B.call(Object),L=RegExp("^"+B.call(O).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),U=b?v.Buffer:void 0,F=v.Symbol,q=v.Uint8Array,z=(U&&U.allocUnsafe,R=Object.getPrototypeOf,C=Object,function(t){return R(C(t))}),V=Object.create,W=M.propertyIsEnumerable,H=T.splice,$=F?F.toStringTag:void 0,Y=function(){try{var t=pt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),X=U?U.isBuffer:void 0,J=Math.max,G=Date.now,K=pt(v,"Map"),Q=pt(Object,"create"),Z=function(){function t(){}return function(e){if(!St(e))return{};if(V)return V(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function tt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function et(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function nt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function rt(t){var e=this.__data__=new et(t);this.size=e.size}function it(t,e,n){(void 0===n||mt(t[e],n))&&(void 0!==n||e in t)||at(t,e,n)}function st(t,e,n){var r=t[e];O.call(t,e)&&mt(r,n)&&(void 0!==n||e in t)||at(t,e,n)}function ot(t,e){for(var n=t.length;n--;)if(mt(t[n][0],e))return n;return-1}function at(t,e,n){"__proto__"==e&&Y?Y(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}tt.prototype.clear=function(){this.__data__=Q?Q(null):{},this.size=0},tt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},tt.prototype.get=function(t){var e=this.__data__;if(Q){var n=e[t];return n===r?void 0:n}return O.call(e,t)?e[t]:void 0},tt.prototype.has=function(t){var e=this.__data__;return Q?void 0!==e[t]:O.call(e,t)},tt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Q&&void 0===e?r:e,this},et.prototype.clear=function(){this.__data__=[],this.size=0},et.prototype.delete=function(t){var e=this.__data__,n=ot(e,t);return!(n<0||(n==e.length-1?e.pop():H.call(e,n,1),--this.size,0))},et.prototype.get=function(t){var e=this.__data__,n=ot(e,t);return n<0?void 0:e[n][1]},et.prototype.has=function(t){return ot(this.__data__,t)>-1},et.prototype.set=function(t,e){var n=this.__data__,r=ot(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},nt.prototype.clear=function(){this.size=0,this.__data__={hash:new tt,map:new(K||et),string:new tt}},nt.prototype.delete=function(t){var e=ft(this,t).delete(t);return this.size-=e?1:0,e},nt.prototype.get=function(t){return ft(this,t).get(t)},nt.prototype.has=function(t){return ft(this,t).has(t)},nt.prototype.set=function(t,e){var n=ft(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},rt.prototype.clear=function(){this.__data__=new et,this.size=0},rt.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},rt.prototype.get=function(t){return this.__data__.get(t)},rt.prototype.has=function(t){return this.__data__.has(t)},rt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof et){var r=n.__data__;if(!K||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new nt(r)}return n.set(t,e),this.size=n.size,this};var ct=function(t,e,n){for(var r=-1,i=Object(t),s=n(t),o=s.length;o--;){var a=s[++r];if(!1===e(i[a],a,i))break}return t};function ht(t){return null==t?void 0===t?f:h:$&&$ in Object(t)?function(t){var e=O.call(t,$),n=t[$];try{t[$]=void 0;var r=!0}catch(t){}var i=N.call(t);return r&&(e?t[$]=n:delete t[$]),i}(t):function(t){return N.call(t)}(t)}function ut(t){return xt(t)&&ht(t)==s}function lt(t,e,n,r,i){t!==e&&ct(e,function(s,o){if(St(s))i||(i=new rt),function(t,e,n,r,i,s,o){var a=x(t,n),c=x(e,n),h=o.get(c);if(h)it(t,n,h);else{var l,f,p,d,g,y=s?s(a,c,n+"",t,e,o):void 0,m=void 0===y;if(m){var v=_t(c),_=!v&&bt(c),w=!v&&!_&&At(c);y=c,v||_||w?_t(a)?y=a:xt(g=a)&&wt(g)?y=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(a):_?(m=!1,y=function(t,e){return t.slice()}(c)):w?(m=!1,d=new(p=(l=c).buffer).constructor(p.byteLength),new q(d).set(new q(p)),f=d,y=new l.constructor(f,l.byteOffset,l.length)):y=[]:function(t){if(!xt(t)||ht(t)!=u)return!1;var e=z(t);if(null===e)return!0;var n=O.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&B.call(n)==D}(c)||vt(c)?(y=a,vt(a)?y=function(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;void 0===c&&(c=t[a]),i?at(n,a,c):st(n,a,c)}return n}(a,Rt(a)):(!St(a)||r&&Et(a))&&(y=function(t){return"function"!=typeof t.constructor||gt(t)?{}:Z(z(t))}(c))):m=!1}m&&(o.set(c,y),i(y,c,r,s,o),o.delete(c)),it(t,n,y)}}(t,e,o,n,lt,r,i);else{var a=r?r(x(t,o),s,o+"",t,e,i):void 0;void 0===a&&(a=s),it(t,o,a)}},Rt)}function ft(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function pt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!St(t)||j&&j in t)&&(Et(t)?L:p).test(function(t){if(null!=t){try{return B.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}(n)?n:void 0}function dt(t,e){var n=typeof t;return!!(e=null==e?i:e)&&("number"==n||"symbol"!=n&&d.test(t))&&t>-1&&t%1==0&&t<e}function gt(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||M)}var yt=function(t){var e=0,n=0;return function(){var r=G(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(Y?function(t,e){return Y(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:Pt);function mt(t,e){return t===e||t!=t&&e!=e}var vt=ut(function(){return arguments}())?ut:function(t){return xt(t)&&O.call(t,"callee")&&!W.call(t,"callee")},_t=Array.isArray;function wt(t){return null!=t&&kt(t.length)&&!Et(t)}var bt=X||function(){return!1};function Et(t){if(!St(t))return!1;var e=ht(t);return e==a||e==c||e==o||e==l}function kt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}function St(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function xt(t){return null!=t&&"object"==typeof t}var At=S?function(t){return function(e){return t(e)}}(S):function(t){return xt(t)&&kt(t.length)&&!!g[ht(t)]};function Rt(t){return wt(t)?function(t,e){var n=_t(t),r=!n&&vt(t),i=!n&&!r&&bt(t),s=!n&&!r&&!i&&At(t),o=n||r||i||s,a=o?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var h in t)!e&&!O.call(t,h)||o&&("length"==h||i&&("offset"==h||"parent"==h)||s&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||dt(h,c))||a.push(h);return a}(t,!0):function(t){if(!St(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=gt(t),n=[];for(var r in t)("constructor"!=r||!e&&O.call(t,r))&&n.push(r);return n}(t)}var Ct,Tt=(Ct=function(t,e,n){lt(t,e,n)},function(t,e){return yt(function(t,e,n){return e=J(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=J(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,a)}}(t,e,Pt),t+"")}(function(t,e){var n=-1,r=e.length,i=r>1?e[r-1]:void 0,s=r>2?e[2]:void 0;for(i=Ct.length>3&&"function"==typeof i?(r--,i):void 0,s&&function(t,e,n){if(!St(n))return!1;var r=typeof e;return!!("number"==r?wt(n)&&dt(e,n.length):"string"==r&&e in n)&&mt(n[e],t)}(e[0],e[1],s)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var o=e[n];o&&Ct(t,o,n)}return t}));function Pt(t){return t}n.exports=Tt}).call(this,n(0),n(18)(t))},function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,c,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(s(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),o=(h=n.slice()).length,c=0;c<o;c++)h[c].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},n.prototype.removeListener=function(t,e){var n,s,o,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(n=this._events[t]).length,s=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=o;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){s=a;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,n){var r=n(166),i=n(165);t.exports=function(t,e,n){var s=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var a=0;a<16;++a)e[s+a]=o[a];return e||i(o)}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){(e=t.exports=n(49)).Stream=e,e.Readable=e,e.Writable=n(23),e.Duplex=n(8),e.Transform=n(44),e.PassThrough=n(137)},function(t,e){var n,r,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var c,h=[],u=!1,l=-1;function f(){u&&c&&(u=!1,c.length?h=c.concat(h):l=-1,h.length&&p())}function p(){if(!u){var t=a(f);u=!0;for(var e=h.length;e;){for(c=h,h=[];++l<e;)c&&c[l].run();l=-1,e=h.length}c=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new d(t,e)),1!==h.length||u||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){"use strict";var r=n(17),i=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=l;var s=n(13);s.inherits=n(5);var o=n(49),a=n(23);s.inherits(l,o);for(var c=i(a.prototype),h=0;h<c.length;h++){var u=c[h];l.prototype[u]||(l.prototype[u]=a.prototype[u])}function l(t){if(!(this instanceof l))return new l(t);o.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||r.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),l.prototype._destroy=function(t,e){this.push(null),this.end(),r.nextTick(e,t)}},function(t,e,n){(function(t){var r,i=n(118),s=n(35),o=n(116),a=n(115),c=n(114);t&&t.ArrayBuffer&&(r=n(113));var h="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),u="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=h||u;e.protocol=3;var f=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(f),d={type:"error",data:"parser error"},g=n(112);function y(t,e,n){for(var r=new Array(t.length),i=a(t.length,n),s=function(t,n,i){e(n,function(e,n){r[t]=n,i(e,r)})},o=0;o<t.length;o++)s(o,t[o],i)}e.encodePacket=function(n,r,i,s){"function"==typeof r&&(s=r,r=!1),"function"==typeof i&&(s=i,i=null);var o=void 0===n.data?void 0:n.data.buffer||n.data;if(t.ArrayBuffer&&o instanceof ArrayBuffer)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=t.data,s=new Uint8Array(i),o=new Uint8Array(1+i.byteLength);o[0]=f[t.type];for(var a=0;a<s.length;a++)o[a+1]=s[a];return r(o.buffer)}(n,r,s);if(g&&o instanceof t.Blob)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);if(l)return function(t,n,r){if(!n)return e.encodeBase64Packet(t,r);var i=new FileReader;return i.onload=function(){t.data=i.result,e.encodePacket(t,n,!0,r)},i.readAsArrayBuffer(t.data)}(t,n,r);var i=new Uint8Array(1);return i[0]=f[t.type],r(new g([i.buffer,t.data]))}(n,r,s);if(o&&o.base64)return function(t,n){return s("b"+e.packets[t.type]+t.data.data)}(n);var a=f[n.type];return void 0!==n.data&&(a+=i?c.encode(String(n.data),{strict:!1}):String(n.data)),s(""+a)},e.encodeBase64Packet=function(n,r){var i,s="b"+e.packets[n.type];if(g&&n.data instanceof t.Blob){var o=new FileReader;return o.onload=function(){var t=o.result.split(",")[1];r(s+t)},o.readAsDataURL(n.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(t){for(var a=new Uint8Array(n.data),c=new Array(a.length),h=0;h<a.length;h++)c[h]=a[h];i=String.fromCharCode.apply(null,c)}return s+=t.btoa(i),r(s)},e.decodePacket=function(t,n,r){if(void 0===t)return d;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(r&&!1===(t=function(t){try{t=c.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return d;var i=t.charAt(0);return Number(i)==i&&p[i]?t.length>1?{type:p[i],data:t.substring(1)}:{type:p[i]}:d}i=new Uint8Array(t)[0];var s=o(t,1);return g&&"blob"===n&&(s=new g([s])),{type:p[i],data:s}},e.decodeBase64Packet=function(t,e){var n=p[t.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:t.substr(1)}};var i=r.decode(t.substr(1));return"blob"===e&&g&&(i=new g([i])),{type:n,data:i}},e.encodePayload=function(t,n,r){"function"==typeof n&&(r=n,n=null);var i=s(t);return n&&i?g&&!l?e.encodePayloadAsBlob(t,r):e.encodePayloadAsArrayBuffer(t,r):t.length?void y(t,function(t,r){e.encodePacket(t,!!i&&n,!1,function(t){r(null,function(t){return t.length+":"+t}(t))})},function(t,e){return r(e.join(""))}):r("0:")},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);var i;if("function"==typeof n&&(r=n,n=null),""===t)return r(d,0,1);for(var s,o,a="",c=0,h=t.length;c<h;c++){var u=t.charAt(c);if(":"===u){if(""===a||a!=(s=Number(a)))return r(d,0,1);if(a!=(o=t.substr(c+1,s)).length)return r(d,0,1);if(o.length){if(i=e.decodePacket(o,n,!1),d.type===i.type&&d.data===i.data)return r(d,0,1);if(!1===r(i,c+s,h))return}c+=s,a=""}else a+=u}return""!==a?r(d,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){if(!t.length)return n(new ArrayBuffer(0));y(t,function(t,n){e.encodePacket(t,!0,!0,function(t){return n(null,t)})},function(t,e){var r=e.reduce(function(t,e){var n;return t+(n="string"==typeof e?e.length:e.byteLength).toString().length+n+2},0),i=new Uint8Array(r),s=0;return e.forEach(function(t){var e="string"==typeof t,n=t;if(e){for(var r=new Uint8Array(t.length),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);n=r.buffer}i[s++]=e?0:1;var a=n.byteLength.toString();for(o=0;o<a.length;o++)i[s++]=parseInt(a[o]);for(i[s++]=255,r=new Uint8Array(n),o=0;o<r.length;o++)i[s++]=r[o]}),n(i.buffer)})},e.encodePayloadAsBlob=function(t,n){y(t,function(t,n){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var r=new Uint8Array(t.length),i=0;i<t.length;i++)r[i]=t.charCodeAt(i);t=r.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),o=new Uint8Array(s.length+1);for(i=0;i<s.length;i++)o[i]=parseInt(s[i]);if(o[s.length]=255,g){var a=new g([e.buffer,o.buffer,t]);n(null,a)}})},function(t,e){return n(new g(e))})},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var i=t,s=[];i.byteLength>0;){for(var a=new Uint8Array(i),c=0===a[0],h="",u=1;255!==a[u];u++){if(h.length>310)return r(d,0,1);h+=a[u]}i=o(i,2+h.length),h=parseInt(h);var l=o(i,0,h);if(c)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(t){var f=new Uint8Array(l);for(l="",u=0;u<f.length;u++)l+=String.fromCharCode(f[u])}s.push(l),i=o(i,h)}var p=s.length;s.forEach(function(t,i){r(e.decodePacket(t,n,!0),i,p)})}}).call(this,n(0))},function(t,e,n){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if((n=r[i])===e||n.fn===e){r.splice(i,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(145),i=n(144),s=n(48);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return h(this,t,e,n)}function h(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=f(t,e),t}(t,e,n,r):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(e,n),i=(t=a(t,r)).write(e,n);return i!==r&&(t=t.slice(0,i)),t}(t,e,n):function(t,e){if(c.isBuffer(e)){var n=0|p(e.length);return 0===(t=a(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?a(t,0):f(t,e);if("Buffer"===e.type&&s(e.data))return f(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e){if(u(e),t=a(t,e<0?0:0|p(e)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|p(e.length);t=a(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function p(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function d(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(t).length;default:if(r)return F(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function y(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:m(t,e,n,r,i);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):m(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,n,r,i){var s,o=1,a=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,n/=2}function h(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var u=-1;for(s=n;s<a;s++)if(h(t,s)===h(e,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===c)return u*o}else-1!==u&&(s-=s-u),u=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){for(var l=!0,f=0;f<c;f++)if(h(t,s+f)!==h(e,f)){l=!1;break}if(l)return s}return-1}function v(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=e.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(2*o,2),16);if(isNaN(a))return o;t[n+o]=a}return o}function _(t,e,n,r){return z(F(e,t.length-n),t,n,r)}function w(t,e,n,r){return z(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function b(t,e,n,r){return w(t,e,n,r)}function E(t,e,n,r){return z(q(e),t,n,r)}function k(t,e,n,r){return z(function(t,e){for(var n,r,i,s=[],o=0;o<t.length&&!((e-=2)<0);++o)r=(n=t.charCodeAt(o))>>8,i=n%256,s.push(i),s.push(r);return s}(e,t.length-n),t,n,r)}function S(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function x(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var s,o,a,c,h=t[i],u=null,l=h>239?4:h>223?3:h>191?2:1;if(i+l<=n)switch(l){case 1:h<128&&(u=h);break;case 2:128==(192&(s=t[i+1]))&&(c=(31&h)<<6|63&s)>127&&(u=c);break;case 3:s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&(c=(15&h)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(u=c);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(u=c)}null===u?(u=65533,l=1):u>65535&&(u-=65536,r.push(u>>>10&1023|55296),u=56320|1023&u),r.push(u),i+=l}return function(t){var e=t.length;if(e<=A)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=A));return n}(r)}e.Buffer=c,e.SlowBuffer=function(t){return+t!=t&&(t=0),c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,n){return h(null,t,e,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,n){return function(t,e,n,r){return u(e),e<=0?a(t,e):void 0!==n?"string"==typeof r?a(t,e).fill(n,r):a(t,e).fill(n):a(t,e)}(null,t,e,n)},c.allocUnsafe=function(t){return l(null,t)},c.allocUnsafeSlow=function(t){return l(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!s(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=c.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,n);case"utf8":case"utf-8":return x(this,e,n);case"ascii":return R(this,e,n);case"latin1":case"binary":return C(this,e,n);case"base64":return S(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,n,r,i){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var s=i-r,o=n-e,a=Math.min(s,o),h=this.slice(r,i),u=t.slice(e,n),l=0;l<a;++l)if(h[l]!==u[l]){s=h[l],o=u[l];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return y(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return y(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return _(this,t,e,n);case"ascii":return w(this,t,e,n);case"latin1":case"binary":return b(this,t,e,n);case"base64":return E(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function R(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function C(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function T(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=e;s<n;++s)i+=U(t[s]);return i}function P(t,e,n){for(var r=t.slice(e,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function M(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function I(t,e,n,r,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function B(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,s=Math.min(t.length-n,2);i<s;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function O(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,s=Math.min(t.length-n,4);i<s;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function j(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(t,e,n,r,s){return s||j(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function D(t,e,n,r,s){return s||j(t,0,n,8),i.write(t,e,n,r,52,8),n+8}c.prototype.slice=function(t,e){var n,r=this.length;if(t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=c.prototype;else{var i=e-t;n=new c(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+t]}return n},c.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r},c.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},c.prototype.readUInt8=function(t,e){return e||M(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||M(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||M(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||M(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||M(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var r=this[t],i=1,s=0;++s<e&&(i*=256);)r+=this[t+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||M(t,e,this.length);for(var r=e,i=1,s=this[t+--r];r>0&&(i*=256);)s+=this[t+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},c.prototype.readInt8=function(t,e){return e||M(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||M(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){e||M(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return e||M(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||M(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||M(t,4,this.length),i.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||M(t,4,this.length),i.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||M(t,8,this.length),i.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||M(t,8,this.length),i.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[e]=255&t;++s<n&&(i*=256);)this[e+s]=t/i&255;return e+n},c.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||I(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+n},c.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):O(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<n&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);I(this,t,e,n,i-1,-i)}var s=n-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):O(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,n){return N(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return N(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return D(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return D(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,s=r-n;if(this===t&&n<e&&e<r)for(i=s-1;i>=0;--i)t[i+e]=this[i+n];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+s),e);return s},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var s;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(s=e;s<n;++s)this[s]=t;else{var o=c.isBuffer(t)?t:F(new c(t,r).toString()),a=o.length;for(s=0;s<n-e;++s)this[s+e]=o[s%a]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function U(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var n;e=e||1/0;for(var r=t.length,i=null,s=[],o=0;o<r;++o){if((n=t.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function q(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function z(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(0))},function(t,e,n){"use strict";const r=n(3);t.exports=class extends r{constructor(t){super(),this._rps=this._buildRPS(t),this._options=t,this._id=this._rps.PEER}get id(){return this._id}get rps(){return this._rps}get inviewId(){throw new Error("A valid network must implement a inviewId getter")}get outviewId(){throw new Error("A valid network must implement a outviewId getter")}_buildRPS(t){throw new Error("A valid network must implement a _buildRPS method using options",t)}getNeighbours(t){throw new Error("A valid network must implement a getNeighbours method with limit",t)}}},function(t,e,n){(function(t){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===n(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===n(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===n(t)},e.isError=function(t){return"[object Error]"===n(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,n(11).Buffer)},function(t,e,n){var r=n(11),i=r.Buffer;function s(t,e){for(var n in t)e[n]=t[n]}function o(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(s(r,e),e.Buffer=o),s(i,o),o.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},o.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){e.encode=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split("&"),r=0,i=n.length;r<i;r++){var s=n[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},function(t,e,n){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,n)});case 3:return e.nextTick(function(){t.call(null,n,r)});case 4:return e.nextTick(function(){t.call(null,n,r,i)});default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return e.nextTick(function(){t.apply(null,s)})}}}:t.exports=e}).call(this,n(7))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){"use strict";const r=n(1)("n2n-overlay-wrtc"),i=n(105),s=n(3),o=n(2),a=n(4),c=n(90),h=n(89),u=n(88),l=n(87);t.exports=class extends s{constructor(t={}){super(),this.options=o({pid:a(),peer:a(),retry:5},t),this.PID=this.options.pid,this.NI=this.options.inview||new i(o(o({},this.options),{peer:this.options.peer+"-I"})),this.NO=this.options.outview||new i(o(o({},this.options),{peer:this.options.peer+"-O"})),this.II=this.NI.register(this),this.IO=this.NO.register(this),this.PEER=this.II.peer+"|"+this.IO.peer,r("[%s] registered to ==> %s ==>",this.PID,this.PEER),this.i=new Map,this.o=new Map}_pid(){return this.PID}_received(t,e){e.type?"MConnectTo"===e.type||"MForwarded"===e.type||"MForwardTo"===e.type?this._bridge(t,e):"MResponse"===e.type||"MRequest"===e.type||"MDirect"===e.type?this._direct(t,e):this.emit("receive",t,e):this.emit("receive",t,e)}_streamed(t,e){this.emit("stream",t,e)}_connected(t,e){e?(this.o.has(t)||this.o.set(t,0),this.o.set(t,this.o.get(t)+1),this.emit("open",t)):(this.i.has(t)||this.i.set(t,0),this.i.set(t,this.i.get(t)+1))}_disconnected(t){this.o.has(t)?(this.o.set(t,this.o.get(t)-1),this.o.get(t)<=0&&this.o.delete(t),this.emit("close",t)):this.i.has(t)&&(this.i.set(t,this.i.get(t)-1),this.i.get(t)<=0&&this.i.delete(t))}_failed(t,e){e&&this.emit("fail",t)}_bridge(t,e){e.type&&"MConnectTo"===e.type?this.IO.connect(n=>{this.send(t,new c(e.from,e.to,n),this.options.retry).catch(t=>{})}):e.type&&"MForwardTo"===e.type?this.send(e.to,new h(e.from,e.to,e.message),this.options.retry).catch(t=>{}):e.type&&"MForwarded"===e.type&&"MRequest"===e.message.type?this.II.connect(n=>{this.send(t,new c(e.to,e.from,n),this.options.retry).catch(t=>{})},e.message):e.type&&"MForwarded"===e.type&&"MResponse"===e.message.type&&this.IO.connect(e.message)}_direct(t,e){"MDirect"===e.type&&this.IO.connect(e=>{this.send(t,e,this.options.retry).catch(t=>{})}),"MRequest"===e.type&&this.II.connect(e=>{this.send(t,e,this.options.retry).catch(t=>{})},e),"MResponse"===e.type&&this.IO.connect(e)}send(t,e,n=0){let r;if(this.i.has(t))r=this.II.send(t,e,n);else if(this.o.has(t))r=this.IO.send(t,e,n);else{const i=t.substr(0,t.length-2),s=i+"-I",o=i+"-O";r=this.o.has(s)?this.IO.send(s,e,n):this.i.has(o)?this.II.send(o,e,n):new Promise((r,i)=>{const s=o=>{this.IO.send(t,e,0).then(()=>r()).catch(a=>this.II.send(t,e,0).then(()=>r()).catch(t=>{o<n?setTimeout(()=>{s(o+1)},1e3):i(t)}))};s(0)})}return r}connect(t=null,e=null){"function"==typeof t&&null===e?this.IO.connect(e=>t(e)):"function"==typeof t&&null!==e?(r("[%s] %s <π= ??? =π= %s",this.PID,this.getInviewId(),e.peer),this.II.connect(e=>t(e),e)):null!==t&&"object"==typeof t&&null===e?this.IO.connect(t):(null===t||t!==this.IO.peer&&t!==this.II.peer||(t=null),null===e||e!==this.IO.peer&&e!==this.II.peer||(e=null),null!==t&&null!==e?(r("[%s] %s =π= %s =π> %s",this.PID,t,this.PEER,e),this.send(t,new u(t,e),this.options.retry).catch(t=>{})):null!==t?this.send(t,new l,this.options.retry).catch(t=>{}):null!==e&&this._direct(e,new l))}disconnect(t){void 0===t?(this.II.disconnect(),this.IO.disconnect()):(this.i.has(t)&&this.II.disconnect(t),this.o.has(t)&&this.IO.disconnect(t))}getInview(){return new Map(this.i)}getInviewId(){return this.NI.PEER}getOutview(){return new Map(this.o)}getOutviewId(){return this.NO.PEER}}},function(t,e,n){var r=n(9),i=n(10);function s(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=s,i(s.prototype),s.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},s.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},s.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},s.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},s.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},s.prototype.onData=function(t){var e=r.decodePacket(t,this.socket.binaryType);this.onPacket(e)},s.prototype.onPacket=function(t){this.emit("packet",t)},s.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,n){(function(e){var r=n(120);t.exports=function(t){var n=t.xdomain,i=t.xscheme,s=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!i&&s)return new XDomainRequest}catch(t){}if(!n)try{return new(e[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}).call(this,n(0))},function(t,e,n){var r=n(1)("socket.io-parser"),i=n(10),s=n(123),o=n(40),a=n(39);function c(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=c,e.Decoder=l;var h=e.ERROR+'"encode error"';function u(t){var n=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(n+=t.nsp+","),null!=t.id&&(n+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return h;n+=i}return r("encoded %j as %s",t,n),n}function l(){this.reconstructor=null}function f(t){this.reconPack=t,this.buffers=[]}function p(t){return{type:e.ERROR,data:"parser error: "+t}}c.prototype.encode=function(t,n){r("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){s.removeBlobs(t,function(t){var n=s.deconstructPacket(t),r=u(n.packet),i=n.buffers;i.unshift(r),e(i)})}(t,n):n([u(t)])},i(l.prototype),l.prototype.add=function(t){var n;if("string"==typeof t)n=function(t){var n=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return p("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var s="";"-"!==t.charAt(++n)&&(s+=t.charAt(n),n!=t.length););if(s!=Number(s)||"-"!==t.charAt(n))throw new Error("Illegal attachments");i.attachments=Number(s)}if("/"===t.charAt(n+1))for(i.nsp="";++n;){if(","===(c=t.charAt(n)))break;if(i.nsp+=c,n===t.length)break}else i.nsp="/";var a=t.charAt(n+1);if(""!==a&&Number(a)==a){for(i.id="";++n;){var c;if(null==(c=t.charAt(n))||Number(c)!=c){--n;break}if(i.id+=t.charAt(n),n===t.length)break}i.id=Number(i.id)}if(t.charAt(++n)){var h=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(n));if(!(!1!==h&&(i.type===e.ERROR||o(h))))return p("invalid payload");i.data=h}return r("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new f(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",n))}},l.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},f.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},f.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,n){"use strict";(function(e,r,i){var s=n(17);function o(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(void 0),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=v;var a,c=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?r:s.nextTick;v.WritableState=m;var h=n(13);h.inherits=n(5);var u,l={deprecate:n(138)},f=n(47),p=n(14).Buffer,d=i.Uint8Array||function(){},g=n(46);function y(){}function m(t,e){a=a||n(8),t=t||{};var r=e instanceof a;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,h=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(h||0===h)?h:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===t.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,r,i){--e.pendingcb,n?(s.nextTick(i,r),s.nextTick(S,t,e),t._writableState.errorEmitted=!0,t.emit("error",r)):(i(r),t._writableState.errorEmitted=!0,t.emit("error",r),S(t,e))}(t,n,r,e,i);else{var o=E(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||b(t,n),r?c(w,t,n,o,i):w(t,n,o,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new o(this)}function v(t){if(a=a||n(8),!(u.call(v,this)||this instanceof a))return new v(t);this._writableState=new m(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),f.call(this)}function _(t,e,n,r,i,s,o){e.writelen=r,e.writecb=o,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function w(t,e,n,r){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),S(t,e)}function b(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),s=e.corkedRequestsFree;s.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,_(t,e,!0,e.length,i,"",s.finish),e.pendingcb++,e.lastBufferedRequest=null,s.next?(e.corkedRequestsFree=s.next,s.next=null):e.corkedRequestsFree=new o(e),e.bufferedRequestCount=0}else{for(;n;){var h=n.chunk,u=n.encoding,l=n.callback;if(_(t,e,!1,e.objectMode?1:h.length,h,u,l),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function E(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function k(t,e){t._final(function(n){e.pendingcb--,n&&t.emit("error",n),e.prefinished=!0,t.emit("prefinish"),S(t,e)})}function S(t,e){var n=E(e);return n&&(function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,s.nextTick(k,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),n}h.inherits(v,f),m.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(m.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(t){return!!u.call(this,t)||this===v&&t&&t._writableState instanceof m}})):u=function(t){return t instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(t,e,n){var r,i=this._writableState,o=!1,a=!i.objectMode&&(r=t,p.isBuffer(r)||r instanceof d);return a&&!p.isBuffer(t)&&(t=function(t){return p.from(t)}(t)),"function"==typeof e&&(n=e,e=null),a?e="buffer":e||(e=i.defaultEncoding),"function"!=typeof n&&(n=y),i.ended?function(t,e){var n=new Error("write after end");t.emit("error",n),s.nextTick(e,n)}(this,n):(a||function(t,e,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),s.nextTick(r,o),i=!1),i}(this,i,t,n))&&(i.pendingcb++,o=function(t,e,n,r,i,s){if(!n){var o=function(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=p.from(e,n)),e}(e,r,i);r!==o&&(n=!0,i="buffer",r=o)}var a=e.objectMode?1:r.length;e.length+=a;var c=e.length<e.highWaterMark;if(c||(e.needDrain=!0),e.writing||e.corked){var h=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:s,next:null},h?h.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else _(t,e,!1,a,r,i,s);return c}(this,i,a,t,e,n)),o},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||b(this,t))},v.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!==t&&void 0!==t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(t,e,n){e.ending=!0,S(t,e),n&&(e.finished?s.nextTick(n):t.once("finish",n)),e.ended=!0,t.writable=!1}(this,r,n)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,n(7),n(140).setImmediate,n(0))},function(t,e,n){"use strict";const r=n(51),i=n(158),s=n(147),o=n(146),a=n(135);t.exports=class{constructor(t,e){this.network=t,this.unicast=new r(this.network,e),this.broadcast=new i(this.network,e),this._unicastStreams=new r(this.network,`${e}-streams`),this._broadcastStreams=new i(this.network,`${e}-streams`),this._activeStreams=new Map,this._middlewares=new s}use(t,e=0){this._middlewares.register(t,e)}sendUnicast(t,e){return this.unicast.send(t,this._middlewares.in(e))}streamUnicast(t){return new o(e=>{e.payload=this._middlewares.in(e.payload),this._unicastStreams.send(t,e)})}sendMulticast(t,e){return this.unicast.sendMultiple(t,this._middlewares.in(e))}sendBroadcast(t,e,n){return this.broadcast.send(this._middlewares.in(t),e,n)}streamBroadcast(t){return new o((t,e,n)=>(t.payload=this._middlewares.in(t.payload),this._broadcastStreams.send(t,e,n)),t)}onUnicast(t){this.unicast.on("receive",(e,n)=>{t(e,this._middlewares.out(n))})}onStreamUnicast(t){this._unicastStreams.on("receive",(e,n)=>this._handleStreamMessage(e,n,t))}onOnceUnicast(t){this.unicast.once("receive",(e,n)=>{t(e,this._middlewares.out(n))})}onBroadcast(t){this.broadcast.on("receive",(e,n)=>t(e,this._middlewares.out(n)))}onStreamBroadcast(t){this._broadcastStreams.on("receive",(e,n)=>this._handleStreamMessage(e,n,t))}onOnceBroadcast(t){this.broadcast.once("receive",(e,n)=>t(e,this._middlewares.out(n)))}removeAllUnicastCallback(){this.unicast.removeAllListeners("receive")}removeAllBroacastCallback(){this.broadcast.removeAllListeners("receive")}_handleStreamMessage(t,e,n){switch(this._activeStreams.has(e.id)||(this._activeStreams.set(e.id,new a),n(t,this._activeStreams.get(e.id))),e.type){case"chunk":this._activeStreams.get(e.id).push(e.payload);break;case"trailers":if(!this._activeStreams.has(e.id))throw new Error(`Cannot add trailers to an unkown stream with id = ${e.id}`);this._activeStreams.get(e.id)._trailers=e.payload;break;case"end":this._closeStream(e.id);break;case"error":if(!this._activeStreams.has(e.id))throw new Error(`Cannot transmit an error to an unkown stream with id = ${e.id}`);this._activeStreams.get(e.id).emit("error",e.payload),this._closeStream(e.id);break;default:throw new Error(`Unknown StreamMessage type found in incoming stream message: ${e.type}`)}}_closeStream(t){if(!this._activeStreams.has(t))throw new Error(`Cannot close an unkown stream with id = ${t}`);this._activeStreams.get(t).push(null),this._activeStreams.delete(t)}}},function(t,e,n){"use strict";const r=n(3);t.exports=class extends r{constructor(t,e){super(),this._source=t,this._protocol=e}send(t){throw new Error("A valid communication protocol should implement a send method, message:"+t.toString())}_receive(t,e){throw new Error("A valid communication protocol should implement a _receiveMessage method; "+`(id, message)=(${t.toString()},${e.toString()})`)}}},function(t,e,n){"use strict";const r=n(27);function i(t){return e=>{let n;return t.reduce((t,e)=>void 0===(n=e(t))||null===n?t:n,e)}}t.exports=class{constructor(t){this._serviceName=t,this._camelCasedName=r.camelCase(this._serviceName),this._capitalizedCamelCase=r.capitalize(this._camelCasedName)}get methodName(){return this._camelCasedName}get handlerName(){return`_${this._camelCasedName}`}get beforeSendName(){return`_beforeSend${this._capitalizedCamelCase}`}get beforeReceiveName(){return`_beforeReceive${this._capitalizedCamelCase}`}get afterSendName(){return`_afterSend${this._capitalizedCamelCase}`}get afterReceiveName(){return`_afterReceive${this._capitalizedCamelCase}`}buildService(t){throw new Error("A valid Builder must implement a valid buildService method")}buildHandler(t,e){t.prototype[this.handlerName]=e}buildBeforeHooks(t,e){e.send.length>0&&(t.prototype[this.beforeSendName]=i(e.send)),e.receive.length>0&&(t.prototype[this.beforeReceiveName]=i(e.receive))}buildAfterHooks(t,e){e.send.length>0&&(t.prototype[this.afterSendName]=i(e.send)),e.receive.length>0&&(t.prototype[this.afterReceiveName]=i(e.receive))}}},function(t,e,n){"use strict";const r=t=>t.replace(/(?:^\w|[A-Z]|\b\w)/g,(t,e)=>0===e?t.toLowerCase():t.toUpperCase()).replace(/\s+/g,""),i=t=>t[0].toUpperCase()+t.slice(1);t.exports={camelCase:r,capitalize:i,methodName:t=>r(t),handlerName:t=>`_${r(t)}`,beforeSendName:t=>`_beforeSend${i(r(t))}`,beforeReceiveName:t=>`_beforeReceive${i(r(t))}`,afterSendName:t=>`_afterSend${i(r(t))}`,afterReceiveName:t=>`_afterReceive${i(r(t))}`}},function(t,e,n){const r=n(12),i=n(78),s=n(2);t.exports=class extends r{constructor(t){super(s({webrtc:{trickle:!0,iceServers:[]},origins:"*"},t))}_buildRPS(t){const e=s({config:t.webrtc},t);return new i(e)}get inviewId(){return this._rps.getInviewId()}get outviewId(){return this._rps.getOutviewId()}getNeighbours(t){return this._rps.getPeers(t)}}},function(t,e,n){"use strict";const r=n(12),i=n(106),s=n(2);t.exports=class extends r{constructor(t){super(s({webrtc:{trickle:!0,iceServers:[]},origins:"*"},t))}_buildRPS(t){const e=s({config:t.webrtc},t);return new i(e)}get inviewId(){return this._rps.getInviewId()}get outviewId(){return this._rps.getOutviewId()}getNeighbours(t){return this._rps.getPeers(t)}}},function(t,e){var n=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}},function(t,e){t.exports=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}},function(t,e,n){var r=n(22),i=n(10),s=n(108),o=n(31),a=n(30),c=n(1)("socket.io-client:socket"),h=n(16),u=n(35);t.exports=p;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=i.prototype.emit;function p(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[o(t,"open",a(this,"onopen")),o(t,"packet",a(this,"onpacket")),o(t,"close",a(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var t=s(arguments);return t.unshift("message"),this.emit.apply(this,t),this},p.prototype.emit=function(t){if(l.hasOwnProperty(t))return f.apply(this,arguments),this;var e=s(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:u(e))?r.BINARY_EVENT:r.EVENT,data:e,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},p.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},p.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?h.encode(this.query):this.query;c("sending connect packet with query %s",t),this.packet({type:r.CONNECT,query:t})}else this.packet({type:r.CONNECT})},p.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},p.prototype.onpacket=function(t){var e=t.nsp===this.nsp,n=t.type===r.ERROR&&"/"===t.nsp;if(e||n)switch(t.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(t);break;case r.ACK:case r.BINARY_ACK:this.onack(t);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",t.data)}},p.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?f.apply(this,e):this.receiveBuffer.push(e)},p.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var i=s(arguments);c("sending ack %j",i),e.packet({type:u(i)?r.BINARY_ACK:r.ACK,id:t,data:i})}}},p.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)f.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(t){return this.flags.compress=t,this},p.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}},function(t,e,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),s=64,o={},a=0,c=0;function h(t){var e="";do{e=i[t%s]+e,t=Math.floor(t/s)}while(t>0);return e}function u(){var t=h(+new Date);return t!==r?(a=0,r=t):t+"."+h(a++)}for(;c<s;c++)o[i[c]]=c;u.encode=h,u.decode=function(t){var e=0;for(c=0;c<t.length;c++)e=e*s+o[t.charAt(c)];return e},t.exports=u},function(t,e,n){(function(e){var r=n(117),i=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===i.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===i.call(File);t.exports=function t(n){if(!n||"object"!=typeof n)return!1;if(r(n)){for(var i=0,a=n.length;i<a;i++)if(t(n[i]))return!0;return!1}if("function"==typeof e&&e.isBuffer&&e.isBuffer(n)||"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||s&&n instanceof Blob||o&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return t(n.toJSON(),!0);for(var c in n)if(Object.prototype.hasOwnProperty.call(n,c)&&t(n[c]))return!0;return!1}}).call(this,n(11).Buffer)},function(t,e,n){var r=n(20),i=n(16),s=n(9),o=n(15),a=n(34),c=n(1)("engine.io-client:polling");t.exports=u;var h=null!=new(n(21))({xdomain:!1}).responseType;function u(t){var e=t&&t.forceBase64;h&&!e||(this.supportsBinary=!1),r.call(this,t)}o(u,r),u.prototype.name="polling",u.prototype.doOpen=function(){this.poll()},u.prototype.pause=function(t){var e=this;function n(){c("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){c("pre-pause polling complete"),--r||n()})),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",function(){c("pre-pause writing complete"),--r||n()}))}else n()},u.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},u.prototype.onData=function(t){var e=this;c("polling got data %s",t),s.decodePayload(t,this.socket.binaryType,function(t,n,r){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},u.prototype.doClose=function(){var t=this;function e(){c("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},u.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};s.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},u.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=a()),this.supportsBinary||t.sid||(t.b64=1),t=i.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t}},function(t,e,n){(function(t){var r=n(21),i=n(119),s=n(111),o=n(110);e.polling=function(e){var n=!1,o=!1,a=!1!==e.jsonp;if(t.location){var c="https:"===location.protocol,h=location.port;h||(h=c?443:80),n=e.hostname!==location.hostname||h!==e.port,o=e.secure!==c}if(e.xdomain=n,e.xscheme=o,"open"in new r(e)&&!e.forceJSONP)return new i(e);if(!a)throw new Error("JSONP disabled");return new s(e)},e.websocket=o}).call(this,n(0))},function(t,e,n){var r=n(122),i=n(32),s=n(10),o=n(22),a=n(31),c=n(30),h=n(1)("socket.io-client:manager"),u=n(33),l=n(107),f=Object.prototype.hasOwnProperty;function p(t,e){if(!(this instanceof p))return new p(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new l({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||o;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=p,p.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)f.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},p.prototype.updateSocketIds=function(){for(var t in this.nsps)f.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},p.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},s(p.prototype),p.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},p.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},p.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(t,e){if(h("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;h("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var s=a(n,"open",function(){i.onopen(),t&&t()}),o=a(n,"error",function(e){if(h("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var n=new Error("Connection error");n.data=e,t(n)}else i.maybeReconnectOnOpen()});if(!1!==this._timeout){var c=this._timeout;h("connect attempt will timeout after %d",c);var u=setTimeout(function(){h("connect attempt timed out after %d",c),s.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",c)},c);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(s),this.subs.push(o),this},p.prototype.onopen=function(){h("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(a(t,"data",c(this,"ondata"))),this.subs.push(a(t,"ping",c(this,"onping"))),this.subs.push(a(t,"pong",c(this,"onpong"))),this.subs.push(a(t,"error",c(this,"onerror"))),this.subs.push(a(t,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(t){this.decoder.add(t)},p.prototype.ondecoded=function(t){this.emit("packet",t)},p.prototype.onerror=function(t){h("error",t),this.emitAll("error",t)},p.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new i(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",s),n.on("connect",function(){n.id=r.generateId(t)}),this.autoConnect&&s()}function s(){~u(r.connecting,n)||r.connecting.push(n)}return n},p.prototype.destroy=function(t){var e=u(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},p.prototype.packet=function(t){h("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;r<n.length;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},p.prototype.cleanup=function(){h("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){h("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(t){h("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)h("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();h("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(h("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(h("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(h("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},p.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,n){(function(e){t.exports=function(t){return n&&e.Buffer.isBuffer(t)||r&&(t instanceof e.ArrayBuffer||i(t))};var n="function"==typeof e.Buffer&&"function"==typeof e.Buffer.isBuffer,r="function"==typeof e.ArrayBuffer,i=r&&"function"==typeof e.ArrayBuffer.isView?e.ArrayBuffer.isView:function(t){return t.buffer instanceof e.ArrayBuffer}}).call(this,n(0))},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,i=t.indexOf("["),s=t.indexOf("]");-1!=i&&-1!=s&&(t=t.substring(0,i)+t.substring(i,s).replace(/:/g,";")+t.substring(s,t.length));for(var o=n.exec(t||""),a={},c=14;c--;)a[r[c]]=o[c]||"";return-1!=i&&-1!=s&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(t,e,n){var r=n(124),i=n(22),s=n(38),o=n(1)("socket.io-client");t.exports=e=c;var a=e.managers={};function c(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var n,i=r(t),c=i.source,h=i.id,u=i.path,l=a[h]&&u in a[h].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||l?(o("ignoring socket cache for %s",c),n=s(c,e)):(a[h]||(o("new io instance for %s",c),a[h]=s(c,e)),n=a[h]),i.query&&!e.query&&(e.query=i.query),n.socket(i.path,e)}e.protocol=i.protocol,e.connect=c,e.Manager=n(38),e.Socket=n(32)},function(t,e,n){"use strict";const r=n(3),i=n(42),s=n(1)("foglet-core:signaling"),o=n(2),a=n(4);t.exports=class extends r{constructor(t,e){if(super(),!(t&&e&&e.address&&e.room))throw s(e),new SyntaxError("Not enough parameters, need a source an address and a room.");this.options=o({address:"http://localhost:3000/",origins:"*",room:a(),timeout:2e4,io:i,reconnectionAttempts:10},e),s("Signaling options: ",this.options),this._network=t,this._id=this._network.id,this._source=t.rps,this._socket=this.options.io(this.options.address,{autoConnect:!1,origins:this.options.origins,reconnectionAttempts:this.options.reconnectionAttempts,timeout:this.options.timeout}),this._socket.on("connect_timeout",t=>{this.unsignaling(),this._manageTimeout(t)}),this._socket.on("connect_error",t=>{this.unsignaling(),this._manageConnectionError(t)}),this._socket.on("error",t=>{this.unsignaling(),this._manageError(t)}),this._socket.on("disconnect",t=>{this._manageDisconnection(t)}),this._socket.on("new_spray",t=>{s("Receive a new offer: ",t),this._source.connect(t=>{s("Emit the accepted offer: ",t),this._socket.emit("accept",{id:this._id,offer:t,room:this.options.room})},t)}),this._socket.on("accept_spray",t=>{s("Receive an accepted offer: ",t),this._source.connect(t)})}connection(t=null,e=this.options.timeout){return null===t&&null===this._socket?Promise.reject(new Error("There is no available connection to the server. Try to use the function signaling() before.")):new Promise((n,r)=>{const i=setTimeout(()=>{r(new Error("connection timed out."))},e),o=(t=!1)=>{clearTimeout(i),n({connected:!0,alone:t})},a=t=>{"connected"===t?o():(clearTimeout(i),r(t))};try{t?this._source.join(this.direct(this._network.rps,t.rps)).then(()=>{o()}).catch(a):(s("Connecting to the room "+this.options.room+"..."),this._socket.emit("joinRoom",{id:this._id,room:this.options.room}),this._socket.on("joinedRoom",t=>{t.connected?o(!0):(this._source.join(this._signalingInit()).then(()=>{this._socket.emit("connected",{id:this._id,room:this.options.room})}).catch(a),this._socket.once("connected",()=>{s("Peer connected."),o()})),s("Connected to the room: "+this.options.room)}))}catch(t){r(t)}})}signaling(){s("Connection to the signaling server..."),this._socket.open()}unsignaling(){s("Disconnection from the signaling server..."),this._socket.emit("disconnect"),this._socket.removeAllListeners("connected"),this._socket.removeAllListeners("joinedRoom"),this._socket.close()}direct(t,e){return n=>{e.connect(e=>{t.connect(e)},n)}}_signalingInit(){console.log(this._id);const t=this;return e=>{s("Emit a new offer."),this._socket.emit("new",{id:t._id,tid:a(),offer:e,room:this.options.room})}}_manageTimeout(t){s(t)}_manageError(t){s(t)}_manageDisconnection(t){s(t)}_manageConnectionError(t){s(t)}}},function(t,e,n){"use strict";t.exports=s;var r=n(8),i=n(13);function s(t){if(!(this instanceof s))return new s(t);r.call(this,t),this._transformState={afterTransform:function(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=e&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",o)}function o(){var t=this;"function"==typeof this._flush?this._flush(function(e,n){a(t,e,n)}):a(this,null,null)}function a(t,e,n){if(e)return t.emit("error",e);if(null!=n&&t.push(n),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=n(5),i.inherits(s,r),s.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},s.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},s.prototype._destroy=function(t,e){var n=this;r.prototype._destroy.call(this,t,function(t){e(t),n.emit("close")})}},function(t,e,n){"use strict";var r=n(14).Buffer,i=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(r.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=c,this.end=h,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=u,this.end=l,e=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,n=function(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function h(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function u(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function l(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}e.StringDecoder=s,s.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},s.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},s.prototype.text=function(t,e){var n=function(t,e,n){var r=e.length-1;if(r<n)return 0;var i=o(e[r]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--r<n||-2===i?0:(i=o(e[r]))>=0?(i>0&&(t.lastNeed=i-2),i):--r<n||-2===i?0:(i=o(e[r]))>=0?(i>0&&(2===i?i=0:t.lastNeed=i-3),i):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,n){"use strict";var r=n(17);function i(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var n=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(r.nextTick(i,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,n){t.exports=n(3).EventEmitter},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){"use strict";(function(e,r){var i=n(17);t.exports=_;var s,o=n(48);_.ReadableState=v,n(3).EventEmitter;var a=function(t,e){return t.listeners(e).length},c=n(47),h=n(14).Buffer,u=e.Uint8Array||function(){},l=n(13);l.inherits=n(5);var f=n(143),p=void 0;p=f&&f.debuglog?f.debuglog("stream"):function(){};var d,g=n(142),y=n(46);l.inherits(_,c);var m=["error","close","destroy","pause","resume"];function v(t,e){s=s||n(8),t=t||{};var r=e instanceof s;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,o=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=n(45).StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function _(t){if(s=s||n(8),!(this instanceof _))return new _(t);this._readableState=new v(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function w(t,e,n,r,i){var s,o=t._readableState;return null===e?(o.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,S(t)}}(t,o)):(i||(s=function(t,e){var n,r;return r=e,h.isBuffer(r)||r instanceof u||"string"==typeof e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(o,e)),s?t.emit("error",s):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===h.prototype||(e=function(t){return h.from(t)}(e)),r?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):b(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!n?(e=o.decoder.write(e),o.objectMode||0!==e.length?b(t,o,e,!1):A(t,o)):b(t,o,e,!1))):r||(o.reading=!1)),function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(o)}function b(t,e,n,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,r?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&S(t)),A(t,e)}Object.defineProperty(_.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),_.prototype.destroy=y.destroy,_.prototype._undestroy=y.undestroy,_.prototype._destroy=function(t,e){this.push(null),e(t)},_.prototype.push=function(t,e){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=h.from(t,e),e=""),n=!0),w(this,t,e,!1,n)},_.prototype.unshift=function(t){return w(this,t,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(t){return d||(d=n(45).StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var E=8388608;function k(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=E?t=E:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function S(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(p("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i.nextTick(x,t):x(t))}function x(t){p("emit readable"),t.emit("readable"),P(t)}function A(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(R,t,e))}function R(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(p("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function C(t){p("readable nexttick read 0"),t.read(0)}function T(t,e){e.reading||(p("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),P(t),e.flowing&&!e.reading&&t.read(0)}function P(t){var e=t._readableState;for(p("flow",e.flowing);e.flowing&&null!==t.read(););}function M(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,r=1,i=n.data;for(t-=i.length;n=n.next;){var s=n.data,o=t>s.length?s.length:t;if(o===s.length?i+=s:i+=s.slice(0,t),0==(t-=o)){o===s.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=s.slice(o));break}++r}return e.length-=r,i}(t,e):function(t,e){var n=h.allocUnsafe(t),r=e.head,i=1;for(r.data.copy(n),t-=r.data.length;r=r.next;){var s=r.data,o=t>s.length?s.length:t;if(s.copy(n,n.length-t,0,o),0==(t-=o)){o===s.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=s.slice(o));break}++i}return e.length-=i,n}(t,e),r}(t,e.buffer,e.decoder),n);var n}function I(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i.nextTick(B,e,t))}function B(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function O(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}_.prototype.read=function(t){p("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return p("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?I(this):S(this),null;if(0===(t=k(t,e))&&e.ended)return 0===e.length&&I(this),null;var r,i=e.needReadable;return p("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&p("length less than watermark",i=!0),e.ended||e.reading?p("reading or ended",i=!1):i&&(p("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=k(n,e))),null===(r=t>0?M(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&I(this)),null!==r&&this.emit("data",r),r},_.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},_.prototype.pipe=function(t,e){var n=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,p("pipe count=%d opts=%j",s.pipesCount,e);var c=e&&!1===e.end||t===r.stdout||t===r.stderr?v:h;function h(){p("onend"),t.end()}s.endEmitted?i.nextTick(c):n.once("end",c),t.on("unpipe",function e(r,i){p("onunpipe"),r===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,p("cleanup"),t.removeListener("close",y),t.removeListener("finish",m),t.removeListener("drain",u),t.removeListener("error",g),t.removeListener("unpipe",e),n.removeListener("end",h),n.removeListener("end",v),n.removeListener("data",d),l=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||u())});var u=function(t){return function(){var e=t._readableState;p("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,P(t))}}(n);t.on("drain",u);var l=!1,f=!1;function d(e){p("ondata"),f=!1,!1!==t.write(e)||f||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==O(s.pipes,t))&&!l&&(p("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,f=!0),n.pause())}function g(e){p("onerror",e),v(),t.removeListener("error",g),0===a(t,"error")&&t.emit("error",e)}function y(){t.removeListener("finish",m),v()}function m(){p("onfinish"),t.removeListener("close",y),v()}function v(){p("unpipe"),n.unpipe(t)}return n.on("data",d),function(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",g),t.once("close",y),t.once("finish",m),t.emit("pipe",n),s.flowing||(p("pipe resume"),n.resume()),t},_.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n),this);if(!t){var r=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)r[s].emit("unpipe",this,n);return this}var o=O(e.pipes,t);return-1===o?this:(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n),this)},_.prototype.on=function(t,e){var n=c.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&S(this):i.nextTick(C,this))}return n},_.prototype.addListener=_.prototype.on,_.prototype.resume=function(){var t=this._readableState;return t.flowing||(p("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(T,t,e))}(this,t)),this},_.prototype.pause=function(){return p("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(p("pause"),this._readableState.flowing=!1,this.emit("pause")),this},_.prototype.wrap=function(t){var e=this,n=this._readableState,r=!1;for(var i in t.on("end",function(){if(p("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(i){p("wrapped data"),n.decoder&&(i=n.decoder.write(i)),(!n.objectMode||null!==i&&void 0!==i)&&(n.objectMode||i&&i.length)&&(e.push(i)||(r=!0,t.pause()))}),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var s=0;s<m.length;s++)t.on(m[s],this.emit.bind(this,m[s]));return this._read=function(e){p("wrapped _read",e),r&&(r=!1,t.resume())},this},Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),_._fromList=M}).call(this,n(0),n(7))},function(t,e,n){"use strict";const r=n(162)("unicast-definition"),i=n(3),s=n(2),o=n(159);t.exports=class extends i{constructor(t,e={}){super(),this.options=s({retry:0,pid:"default-unicast"},e),this.psp=t;let n=t._receive;t._receive=((e,r)=>{try{n.call(t,e,r)}catch(t){if(!r.type||"MUnicast"!==r.type||r.pid!==this.options.pid)throw t;this._emit(r.event,...r.args)}}),this._emit=this.emit,this.emit=((e,n,...r)=>t.send(n,new o(this.options.pid,e,r),this.options.retry)),r("just initialized on top of %s@%s.",this.psp.PID,this.psp.PEER)}destroy(){this.removeAllListener(),this.emit=this._emit}}},function(t,e,n){"use strict";const r=n(163),i=n(50);t.exports=class extends r{constructor(t,e){super(t,e),this._unicast=new i(this._source.rps,{pid:this._protocol}),this._unicast.on(this._protocol,(t,e)=>{this._receive(t,e)})}send(t,e){return this._unicast.emit(this._protocol,t,this._source.outviewId,e)}sendMultiple(t=[],e){return t.reduce((t,n)=>t.then(()=>this.send(n,e)),Promise.resolve())}_receive(t,e){this.emit("receive",t,e)}}},function(t,e,n){(function(e){const r=n(3),i=n(2),s=n(4),o=n(1)("spa"),a=new class{constructor(){this._statistics={message:0},this.manager=new Map,this._options={latency:t=>{setTimeout(t,0)}},o("manager initialized")}get stats(){return this._statistics}newPeer(t){o("new peer added. Size:",this.manager.size),this.manager.set(t.id,t)}connect(t,e){o("peer connected from/to: ",t,e),this.manager.get(e)._connectWith(t),this.manager.get(t)._connectWith(e)}destroy(t,e){o("peer disconnected from/to: ",t,e),this.manager.get(t)&&(this.manager.get(t)._close(),this.manager.delete(t)),this.manager.get(e)&&(this.manager.get(e)._close(),this.manager.delete(e))}send(t,e,n,r=0){this._send(t,e,n,r)}_send(t,e,n,r=0){try{if(!this.manager.has(t)||!this.manager.has(e))throw new Error("need a from and to peer.");this.manager.get(e).emit("data",n),this._statistics.message++}catch(t){throw new Error("cannot send the message. perhaps your destination is not reachable.",t)}}};t.exports=class extends r{constructor(t){super(),this._manager=a,this._options=i((()=>({id:s(),initiator:!1,channelConfig:{},channelName:s(),config:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},constraints:{},offerConstraints:{},answerConstraints:{},reconnectTimer:!1,sdpTransform:function(t){return t},stream:!1,streams:[],trickle:!0,wrtc:{},objectMode:!1}))(),t),this.id=this._options.id,this.WEBRTC_SUPPORT=!0,this._isNegotiating=!1,this.connected=!1,this.disconnected=!1,this.connectedWith=void 0,this.messageBuffer=[],o("peer initiated:",this.id,this._options.initiator),this._options.initiator&&e.nextTick(()=>{this._init()}),this._manager.newPeer(this)}static get manager(){return a}send(t){this.connectedWith?(this.messageBuffer.length>0&&this._reviewMessageBuffer(),this.connectedWith?this._send(this.connectedWith,t):this.messageBuffer.push(t)):this.messageBuffer.push(t)}destroy(){this._manager.destroy(this.id,this.connectedWith)}signal(t){"init"===t.type?(this._isNegotiating=!0,o("offer-init received:",t),this.emit("signal",this._createAccept(t))):"accept"===t.type&&(o("offer-accept received:",t),this._connect(t))}_error(t){o(t),this.emit("error",t)}_close(){o("[%s] is closed.",this.id),this.emit("close")}_init(){this._isNegotiating=!0;const t=this._createOffer();this.emit("signal",t)}_createOffer(){return{offerId:s(),type:"init",offer:{initiator:this.id}}}_createAccept(t){const e=this._createOffer();return e.type="accept",e.offerId=t.offerId,e.offer.initiator=t.offer.initiator,e.offer.acceptor=this.id,e}_reviewMessageBuffer(){for(o("Review the buffer: ",this.messageBuffer.length);this.connectedWith&&0!==this.messageBuffer.length;)this._send(this.messageBuffer.pop())}_send(t=this.connectedWith,e){if(!t)throw new Error("It must have a destination.");this._manager.send(this.id,t,e)}_connect(t){if(!t.offer.acceptor)throw new Error("It must have an acceptor");this._manager.connect(t.offer.initiator,t.offer.acceptor)}_connectWith(t){this.connected=!0,this._isNegotiating=!1,this.connectedWith=t,this.emit("connect")}}}).call(this,n(7))},function(t,e,n){"use strict";t.exports=class{constructor(t,e){this.source=t,this.message=e}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.source=t,this.message=e,this.reason=n}}},function(t,e,n){"use strict";t.exports=class{constructor(){this.type="MRequestDescriptor"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e){this.peer=t,this.descriptor=e,this.type="MGiveDescriptor"}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.peers=t,this.type="MRequire"}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.sample=t,this.type="MSuggestBack"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.peer=t,this.descriptor=e,this.sample=n,this.type="MSuggest"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e){this.peer=t,this.descriptor=e,this.type="MJoin"}}},function(t,e,n){"use strict";t.exports=class extends Map{constructor(t){super(),this.timeout=t}add(t,e){this.set(t,e),setTimeout(()=>{this.has(t)&&this.delete(t)},this.timeout)}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e="unknown"){this.source=t,this.peer=e}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e={}){this.peer=t,this.ages=[0],this.descriptor=e}update(t){this.descriptor=t}increment(){this.ages=this.ages.map(t=>t+1)}add(){this.ages.unshift(0)}removeOldest(){return this.ages.pop(),0===this.ages.length}removeYoungest(){return this.ages.shift(),0===this.ages.length}get oldest(){return this.ages[this.ages.length-1]}get count(){return this.ages.length}}},function(t,e,n){"use strict";const r=n(63),i=n(62);t.exports=class extends Map{get oldest(){if(this.size<=0)throw new i("getOldest");let t=null,e=0;return this.forEach((n,r)=>{e<=n.oldest&&(t=n.peer,e=n.oldest)}),t}increment(){this.forEach((t,e)=>{t.increment()})}addNeighbor(t,e={}){this.has(t)?this.get(t).add():this.set(t,new r(t,e))}updateNeighbor(t,e={}){if(!this.has(t))throw new i("updateNeighbor",t);this.get(t).update(e)}removeOldest(t){if(!this.has(t))throw new i("removeNeighbor",t);this.get(t).removeOldest()&&this.delete(t)}removeAllNeighbor(t){if(this.has(t)){const e=this.get(t).count;return this.delete(t),e}throw new i("removeNeighbor",t)}get leastFrequent(){if(this.size<=0)throw new i("getLeastFrequent");let t=[],e=1/0;return this.forEach((n,r)=>{n.count<e&&(t=[],e=n.count),n.count===e&&t.push(r)}),t[Math.floor(Math.random()*t.length)]}getDescriptor(t){if(this.has(t))return this.get(t).descriptor;throw new i("getDescriptor",t)}}},function(t,e,n){(function(t,n){var r,i,s,o=9007199254740991,a="[object Arguments]",c="[object Function]",h="[object GeneratorFunction]",u="[object Map]",l="[object Set]",f=/^\[object .+?Constructor\]$/,p="object"==typeof t&&t&&t.Object===Object&&t,d="object"==typeof self&&self&&self.Object===Object&&self,g=p||d||Function("return this")(),y="object"==typeof e&&e&&!e.nodeType&&e,m=y&&"object"==typeof n&&n&&!n.nodeType&&n,v=m&&m.exports===y,_=Function.prototype,w=Object.prototype,b=g["__core-js_shared__"],E=(r=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",k=_.toString,S=w.hasOwnProperty,x=w.toString,A=RegExp("^"+k.call(S).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),R=v?g.Buffer:void 0,C=w.propertyIsEnumerable,T=R?R.isBuffer:void 0,P=(i=Object.keys,s=Object,function(t){return i(s(t))}),M=z(g,"DataView"),I=z(g,"Map"),B=z(g,"Promise"),O=z(g,"Set"),j=z(g,"WeakMap"),N=!C.call({valueOf:1},"valueOf"),D=W(M),L=W(I),U=W(B),F=W(O),q=W(j);function z(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!J(t)||E&&E in t)&&(X(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?A:f).test(W(t))}(n)?n:void 0}var V=function(t){return x.call(t)};function W(t){if(null!=t){try{return k.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(M&&"[object DataView]"!=V(new M(new ArrayBuffer(1)))||I&&V(new I)!=u||B&&"[object Promise]"!=V(B.resolve())||O&&V(new O)!=l||j&&"[object WeakMap]"!=V(new j))&&(V=function(t){var e=x.call(t),n="[object Object]"==e?t.constructor:void 0,r=n?W(n):void 0;if(r)switch(r){case D:return"[object DataView]";case L:return u;case U:return"[object Promise]";case F:return l;case q:return"[object WeakMap]"}return e});var H=Array.isArray;function $(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}(t.length)&&!X(t)}var Y=T||function(){return!1};function X(t){var e=J(t)?x.call(t):"";return e==c||e==h}function J(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}n.exports=function(t){if($(t)&&(H(t)||"string"==typeof t||"function"==typeof t.splice||Y(t)||function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&$(t)}(t)&&S.call(t,"callee")&&(!C.call(t,"callee")||x.call(t)==a)}(t)))return!t.length;var e=V(t);if(e==u||e==l)return!t.size;if(N||function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||w)}(t))return!P(t).length;for(var n in t)if(S.call(t,n))return!1;return!0}}).call(this,n(0),n(18)(t))},function(t,e,n){"use strict";const r=n(1)("tman-wrtc"),i=n(19),s=n(50),o=n(2),a=n(65),c=n(64),h=n(61),u=n(60),l=n(59),f=n(58),p=n(57),d=n(56),g=n(55),y=n(54),m=n(53);t.exports=class extends i{constructor(t={},e){super(o({pid:"tman-wrtc",delta:6e4,timeout:12e4,descriptorTimeout:1e4,retry:5,inview:e&&e.NI,outview:e&&e.NO,descriptor:{x:Math.random()},ranking:t=>(e,n)=>{const r=n.descriptor.x-t.descriptor.x,i=e.descriptor.x-t.descriptor.x;return Math.abs(i)-Math.abs(r)}},t)),r("[%s] Initalized with ==> %s ==>",this.PID,this.PEER),this.partialView=new c,this.cache=new h(this.options.timeout),this.state="disconnected",this.periodic=null,this.on("receive",(t,e)=>this._receive(t,e)),this.on("open",t=>{this._open(t),this._updateState()}),this.on("close",t=>{this._close(t),this._updateState()}),this.on("fail",t=>{this._onArcDown(t),this._updateState()}),this.parent=e||null,this.parent&&(this.unicast=new s(this.parent,{pid:"tman-wrtc-unicast",retry:this.options.retry}),this.parent.on("open",t=>!this.cache.has(t)&&this.unicast.emit("requestDescriptor",t,this.getOutviewId()).catch(t=>{console.error(t)})),this.unicast.on("requestDescriptor",t=>this.unicast.emit("giveDescriptor",t,this.getInviewId(),this.options.descriptor).catch(t=>{console.error(t)})),this.unicast.on("giveDescriptor",(t,e)=>{this.cache.has(t)||(r("[%s] get %s's descriptor from %s.",this.PID,t,this.parent.PID),this.cache.add(t,e))}))}join(t){this.parent&&this.parent.join(t);let e=new Promise((t,e)=>{"disconnected"!==this.state&&e(new m("join","Already connected."));let n=setTimeout(()=>{e(new m("join","Timeout exceeded."))},this.options.timeout);this.once("open",r=>{this.send(r,new u(this.getInviewId(),this.options.descriptor),this.options.retry).then(()=>{clearTimeout(n),this._start(),t(r)}).catch(()=>{e(new m("join","Could not notify contact."))})})});return this.connect(t),e}_onJoin(t,e){if(this.partialView.size>0){r("[%s] %s ===> join %s; %s neigbhors ===> %s",this.PID,t,this.PEER,this.partialView.size,t);let e=[];this.partialView.forEach(t=>{e.push({peer:t.peer,descriptor:t.descriptor})}),e.push({peer:this.getInviewId(),descriptor:this.options.descriptor}),this.send(t,new f(e),this.options.retry).catch(t=>{console.error(t)})}else r("[%s] %s ===> join %s ===> %s",this.PID,t,this.PEER,t),this.cache.add(e.peer,e.descriptor),this.connect(null,t),this.send(t,new f([{peer:this.getInviewId(),descriptor:this.options.descriptor}]),this.options.retry).catch(t=>{console.error(t)}),this._start()}_onArcDown(t){}_onPeerDown(t){this.partialView.removeAllNeighbor(t)}_sampleSize(t){return Math.min(t.length,2)}_partialViewSize(){return 4}_getSample(t){let e=[];this.partialView.forEach((t,n)=>{t.ages.forEach(r=>{!a(t.descriptor)&&e.push(n)})}),this.parent&&this.parent.partialView.forEach((t,n)=>{this.cache.has(n)&&e.indexOf(n)<0&&e.push(n)}),e=e.map(e=>{let n={descriptor:this.options.descriptor};return e===t.peer?n.peer=this.getInviewId():(n.descriptor=this.cache.has(e)&&this.cache.get(e)||this.partialView.getDescriptor(e),n.peer=e),n});const n=this._sampleSize(e);return e.sort(this.options.ranking(t)),e.slice(0,n)}_exchange(){if(this.partialView.size<=0&&this.parent&&this.parent.partialView.size<=0)return;let t,e;this.partialView.increment();let n=!0;if(this.partialView.size>0)t=this.partialView.oldest,e=this._getSample(this.partialView.get(t));else if(this.parent&&this.parent.partialView.size>0){let r=this.parent.getPeers(),i=!1;for(n=!1;!i&&r.length>0;){const n=Math.floor(Math.random()*r.length);this.cache.has(r[n])?(i=!0,t=r[n],e=this._getSample({peer:t,descriptor:this.cache.get(t)})):r.splice(n,1)}}t&&this.send(t,new l(this.getInviewId(),this.options.descriptor,e)).then(()=>{r("[%s] %s ==> suggest %s ==> %s",this.PID,this.PEER,e.length,t)}).catch(e=>{r("[%s] %s =X> suggest =X> %s",this.PID,this.PEER,t),n&&this._onPeerDown(t)})}_onExchange(t,e){const n=this._getSample(e);this.send(t,new f(n),this.options.retry).then(()=>{r("[%s] %s ==> suggest back %s ==> %s",this.PID,this.PEER,n.length,t)}).catch(t=>{}),this._onExchangeBack(t,e)}_onExchangeBack(t,e){let n=[];this.partialView.forEach((t,e)=>n.push(t)),e.sample.forEach(t=>n.indexOf(t)<0&&n.push(t)),n.sort(this.options.ranking(this.options));let i=[];n.slice(0,this._partialViewSize()).forEach(t=>{this.partialView.has(t.peer)||(i.push(t.peer),this.cache.add(t.peer,t.descriptor))}),i.length>0&&(r("[%s] %s wants to keep %s peers.",this.PID,this.PEER,i.length),this.send(t,new p(i),this.options.retry).catch(e=>{r("[%s] %s =X> request descriptors %s =X> %s",this.PID,this.PEER,i.length,t)}));let s=n.slice(this._partialViewSize(),n.length);s.length>0&&this.partialView.size>this._partialViewSize()&&s.forEach(t=>{this.partialView.has(t.peer)&&this.disconnect(t.peer)})}_onRequire(t,e){r("[%s] %s requested to be bridged with %s peers",this.PID,t,e.peers.length),e.peers.forEach(e=>{this.connect(t,e)})}_receive(t,e){if(e.type&&"MSuggest"===e.type)this._onExchange(t,e);else if(e.type&&"MSuggestBack"===e.type)this._onExchangeBack(t,e);else if(e.type&&"MRequire"===e.type)this._onRequire(t,e);else if(e.type&&"MJoin"===e.type)this._onJoin(t,e);else if(e.type&&"MGiveDescriptor"===e.type)this.emit(this.PID+"-"+t,e);else{if(!e.type||"MRequestDescriptor"!==e.type)throw new y("_receive",e,"unhandled");this._onRequestDescriptor(t,e)}}_start(t=this.options.delta){this.periodic=setInterval(()=>this._exchange(),t)}_stop(){this.periodic&&clearInterval(this.periodic)}_requestDescriptor(t){return new Promise((e,n)=>{let r=null;this.send(t,new g,this.options.retry).then(()=>{r=setTimeout(()=>{this.removeAllListeners(this.PID+"-"+t),n(new Error("timeout"))},this.options.descriptorTimeout)}).catch(t=>{n(t)}),this.once(this.PID+"-"+t,t=>{clearTimeout(r),this.cache.add(t.peer,t.descriptor),e()})})}_onRequestDescriptor(t,e){this.send(t,new d(this.getInviewId(),this.options.descriptor),this.options.retry).catch(e=>r("[%s] %s =X> give descriptor =X> %s",this.PID,this.PEER,t))}_open(t){r("[%s] %s ===> %s",this.PID,this.PEER,t),this.partialView.has(t)?this.disconnect(t):this.cache.has(t)?this._keep(t):this._requestDescriptor(t).then(()=>{this.partialView.has(t)?this.disconnect(t):this._keep(t)}).catch(e=>{this.disconnect(t)})}_keep(t){let e=[];this.partialView.forEach((t,n)=>e.push(t)),e.push({peer:t,descriptor:this.cache.get(t)}),e.sort(this.options.ranking(this.options)),e.slice(0,this._partialViewSize()),e.splice(0,this._partialViewSize()),(0===e.length||e.indexOf(t)<0)&&this.partialView.addNeighbor(t,this.cache.get(t)),e.forEach(t=>this.disconnect(t.peer))}_close(t){r("[%s] %s =†=> %s",this.PID,this.PEER,t),this.partialView.has(t)&&this.partialView.removeOldest(t)}_updateState(){const t=this.state;this.i.size>0&&this.o.size>0&&"connected"!==t?this.state="connected":this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0&&"partially connected"!==t?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==t&&(this.state="disconnected"),t!==this.state&&this.emit("statechange",this.state)}getPeers(t){let e=[];if(void 0===t)this.partialView.forEach((t,n)=>e.push(n));else{let n=[];for(this.partialView.forEach((t,e)=>n.push(e));e.length<t&&n.length>0;){let t=Math.floor(Math.random()*n.length);e.push(n[t]),n.splice(t,1)}let r=[];for(this.i.forEach((t,e)=>r.push(e));e.length<t&&r.length>0;){let t=Math.floor(Math.random()*r.length);e.push(r[t]),r.splice(t,1)}}return r("[%s] %s provides %s peers",this.PID,this.PEER,e.length),e}}},function(t,e,n){"use strict";const r=n(12),i=n(66),s=n(2);t.exports=class extends r{constructor(t,e){e.manager=t,super(e),this._manager=t,this._rps.parent.once("open",()=>{console.log("SON connected"),this._rps._start()})}get inviewId(){return this.rps.getInviewId()}get outviewId(){return this.rps.getOutviewId()}get descriptor(){return this._rps.options.descriptor}set descriptor(t){this._rps.options.descriptor=t}_buildRPS(t){this.options=s({config:t.webrtc},t);const e=s({descriptor:this._startDescriptor(),descriptorTimeout:this._descriptorTimeout(),ranking:this._rankingFunction()},this.options);return new i(e,t.manager._rps._network._rps)}_startDescriptor(){throw new Error("A valid TMan based overlay must implement a _descriptor method to generate a base descriptor")}_descriptorTimeout(){throw new Error("A valid TMan based overlay must implement a _descriptorTimeout method to give the timeout on descriptors")}_rankPeers(t,e,n,r,i){throw new Error("A valid TMan based overlay must implement a _rankPeers method to rank two peers"+`variable: ${t.toString()}${e.toString()}${n.toString()}${r.toString()}${i.toString()}`)}_rankingFunction(){return t=>(e,n)=>this._rankPeers(t,e.descriptor,n.descriptor,e,n)}getNeighbours(t){return this.rps.getPeers(t)}}},function(t,e,n){"use strict";const r=n(12);t.exports=class extends r{constructor(t){if(super(t),!t.manager)throw new SyntaxError("Need the manager to access to other networks.");this.manager=t.manager}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this._callback=t}apply(t){t.prototype._init=this._callback}}},function(t,e,n){"use strict";const r=n(26);t.exports=class extends r{buildService(t){const e=this.methodName,n=this.beforeSendName,r=this.afterSendName;t.prototype[e]=function(t){const i=this;n in i&&(t=i[n](t));const s={protocol:i._name,method:e,payload:t};i._sendBroadcast(s),r in i&&i[r](t)}}}},function(t,e,n){"use strict";const r=n(26);t.exports=class extends r{buildService(t){const e=this.methodName,n=this.beforeSendName,r=this.afterSendName;t.prototype[e]=function(t,i){const s=this;return n in s&&(i=s[n](i)),new Promise(function(n,o){const a={protocol:s._name,method:e,payload:i};s._sendUnicast(t,a,n,o),r in s&&s[r](i)})}}}},function(t,e,n){"use strict";const r=n(71),i=n(70);t.exports=class{constructor(t){this._serviceName=t,this._builder=null,this._handler=null,this._beforeHooks={send:[],receive:[]},this._afterHooks={send:[],receive:[]}}get is(){return{unicast:()=>{this._builder=new r(this._serviceName)},broadcast:()=>{this._builder=new i(this._serviceName)}}}get on(){return{receive:t=>{this._handler=t}}}get before(){return{send:t=>this._beforeHooks.send.push(t),receive:t=>this._beforeHooks.receive.push(t)}}get after(){return{send:t=>this._afterHooks.send.push(t),receive:t=>this._afterHooks.receive.push(t)}}apply(t){if(!this._validate())throw new class extends Error{}("");this._builder.buildService(t),this._builder.buildHandler(t,this._handler),this._builder.buildBeforeHooks(t,this._beforeHooks),this._builder.buildAfterHooks(t,this._afterHooks)}_validate(){return null!==this._type&&null!==this._handler}}},function(t,e,n){"use strict";const r=n(4);t.exports=class{constructor(){this._waitingAnswers=new Map}stamp(t,e,n){const i=r();return this._waitingAnswers.set(i,{resolve:e,reject:n}),Object.assign({answerID:i},t)}resolve(t,e){this._waitingAnswers.has(t)&&(this._waitingAnswers.get(t).resolve(e),this._waitingAnswers.delete(t))}reject(t,e){this._waitingAnswers.has(t)&&(this._waitingAnswers.get(t).reject(e),this._waitingAnswers.delete(t))}}},function(t,e,n){"use strict";const r=n(73),i=n(27);t.exports=class{constructor(t,e,...n){this._name=t,this._foglet=e,this._answerQueue=new r,this._initHandlers(),"_init"in this&&this._init(...n)}_sendUnicast(t,e,n,r){this._foglet.sendUnicast(t,this._answerQueue.stamp(e,n,r))}_sendBroadcast(t){this._foglet.sendBroadcast(t)}_answerReply(t,e){this._answerQueue.resolve(e.answerID,e.value)}_answerReject(t,e){this._answerQueue.reject(e.answerID,e.value)}_initHandlers(){this._foglet.onUnicast((t,e)=>this._handleUnicast(t,e)),this._foglet.onBroadcast((t,e)=>this._handleBroadcast(t,e))}_handleUnicast(t,e){const n=i.handlerName(e.method);if(this._name===e.protocol&&n in this){const r=i.beforeReceiveName(e.method);if(r in this&&(e.payload=this[r](e.payload)),"answerReply"!==e.method||"answerReject"!==e.method){const r=n=>{this._sendUnicast(t,{protocol:this._name,method:"answerReply",payload:{answerID:e.answerID,value:n}})},i=n=>{this._sendUnicast(t,{protocol:this._name,method:"answerReject",payload:{answerID:e.answerID,value:n}})};this[n](t,e.payload,r,i)}else this[n](t,e.payload);const s=i.afterReceiveName(e.method);s in this&&this[s](e.payload)}}_handleBroadcast(t,e){const n=i.handlerName(e.method);if(this._name===e.protocol&&n in this){const r=i.beforeReceiveName(e.method);r in this&&(e.payload=this[r](e.payload)),this[n](t,e.payload);const s=i.afterReceiveName(e.method);s in this&&this[s](e.payload)}}}},function(t,e,n){"use strict";const r=n(74),i=n(72),s=n(69);t.exports=function(t){return function(e,...n){let o;const a=class extends r{constructor(e,...n){super(t,e,...n)}};return e.map(t=>t.trim()).filter(t=>t.length>0).forEach((t,e)=>{"init"===t||"constructor"===t?o=new s(n[e]):(o=new i(t),n[e](o)),o.apply(a)}),a}}},function(module,exports,__webpack_require__){"use strict";const EventEmitter=__webpack_require__(3),lmerge=__webpack_require__(2),io=__webpack_require__(42);class SshControl extends EventEmitter{constructor(options={}){super(),this.options=lmerge({foglet:void 0,address:"http://localhost:4000/",verbose:!0,origins:"*"},options),this.signaling=io.connect(this.options.address,{origins:options.origins}),this.signaling.emit("join",{id:this.options.foglet.id}),this.signaling.on("remoteCommand",command=>{let parsed;this.log("remoteCommand",command);try{parsed=eval("("+command+")"),this.log(parsed),this.deserialize(parsed.command)(this.options.foglet)}catch(t){this.log(t)}})}deserialize(message){return eval("("+message+")")}log(t,e){this.options.verbose&&void 0!==t&&void 0!==e&&this.emit("logs",t,e)}}module.exports=SshControl},function(t,e){t.exports=class extends Map{get oldest(){if(this.size<=0)throw new Error("oldest peer not found");let t=null,e=0;return this.forEach((n,r)=>{e<=n[n.length-1]&&(t=r,e=n[n.length-1])}),t}increment(){this.forEach((t,e)=>{this.set(e,t.map(t=>t+1))})}add(t){!this.has(t)&&this.set(t,[]),this.get(t).unshift(0)}removeYoungest(t){if(!this.has(t))throw new Error("removeYoungest, peer not found"+t);this.get(t).shift(),0===this.get(t).length&&this.delete(t)}removeOldest(t){if(!this.has(t))throw new Error("removeOldest, peer not found:"+t);this.get(t).pop(),0===this.get(t).length&&this.delete(t)}removeAll(t){if(!this.has(t))throw new Error("removeAll, peer not found: "+t);const e=this.get(t).length;return this.delete(t),e}get leastFrequent(){let t=[],e=1/0;return this.forEach((n,r)=>{n.length<e&&(t=[],e=n.length),n.length===e&&t.push(r)}),t[Math.floor(Math.random()*t.length)]}}},function(t,e,n){const r=n(19),i=n(2),s=n(4),o=n(77),a=n(1)("cyclon");t.exports=class extends r{constructor(t){const e={pid:"cyclon",peer:s(),maxPeers:5,timeoutnetwork:2e4,timeoutconnection:2e4,retry:5,delta:3e4,timeout:3e4};super(i(e,t)),this._partialView=new o,this._periodic=void 0,this.on("receive",(t,e)=>this._receive(t,e)),this.on("open",t=>{this._open(t)}),this.on("close",t=>{this._close(t)}),this.on("fail",t=>{this._onArcDown(t)})}get partialView(){return this._partialView}join(t){return new Promise((e,n)=>{let r=setTimeout(()=>{n(new Error("conenction timed out"))},this.options.timeoutconnection);this.once("open",t=>{this.send(t,{type:"MJoin"},this.options.retry).then(()=>{clearTimeout(r),this._start(),e(t)}).catch(()=>{n(new Error("failed to send a MJoin message after establishing the connection. Please report."))})}),this.connect(t)})}_open(t){a("[%s] %s ===> %s",this.PID,this.PEER,t),this._partialView.has(t)||this._partialView.add(t),this._partialView.size>this.options.maxPeers&&this.disconnect(t)}_close(t){a("[%s] %s =†=> %s",this.PID,this.PEER,t),this._partialView.has(t)&&this._partialView.delete(t)}_onJoin(t){this._partialView.size>0?(a("[%s] %s ===> join %s ===> %s neighbors",this.PID,t,this.PEER,this._partialView.size),this._partialView.forEach((e,n)=>{this.connect(t,n)})):(a("[%s] %s ===> join %s ===> %s",this.PID,t,this.PEER,t),this.connect(null,t))}_onLeave(t){a("%s: just left the game!",t)}_start(){a("[%s] starting periodic shuffling with period=%f",this.PEER,this.options.delta),this._periodic=setInterval(()=>{this.exchange()},this.options.delta)}_stop(){clearInterval(this._periodic)}_receive(t,e){if(e.type&&"MExchange"===e.type)this._onExchange(t,e);else if(e.type&&"MExchangeBack"===e.type)this.emit("MExchangeBack-"+e.id,t,e);else if(e.type&&"MJoin"===e.type)this._onJoin(t);else if(e.type&&"MLeave"===e.type)this._onLeave(t);else{if(!e.type||"MBridge"!==e.type)throw new Error("_receive, message unhandled");this._onBridge(e.from,e.to)}}_exchange(){return this.exchange()}exchange(){return this.emit("begin-shuffle"),new Promise((t,e)=>{0===this._partialView.size&&t(),this._partialView.increment();const n=this._partialView.oldest,r=this._getSample(this.options.maxPeers);this._partialView.removeOldest(n),this._partialView.add(n),r.map(t=>{t.id===n&&(t.id=this.getInviewId(),t.age=0)}),a("[%s] Starting to exchange with %s with a sample of size: %f",this.PEER,n,r.length);const i=s();this.send(n,{type:"MExchange",id:i,from:this.getInviewId(),sample:r},this.options.retry).then(()=>{let e=setTimeout(()=>{this.removeAllListeners("MExchangeBack-"+i),t()},this.options.timeoutnetwork);this.once("MExchangeBack-"+i,(i,s)=>{clearTimeout(e);const o=s.sample.filter(t=>!this._partialView.has(t.id)&&t.id!==n&&t.id!==i);for(let t=0;t<o.length;t++){const e=o[t];if(this._partialView.size>=this.options.maxPeers){const t=Math.floor(Math.random()*r.length),n=r[t].id;r.splice(t,1),a("[%s] replacing entry %s by %s",this.PEER,n,e.id),this.disconnect(n),this._partialView.removeAll(n)}this.send(i,{type:"MBridge",from:this.getInviewId(),to:e.id},this.options.retry).then(()=>{}).catch(t=>{})}t()})}).catch(e=>{console.log("%s Error when sending the sample to %s",this.PEER,n),t()})}).then(()=>(this.emit("end-shuffle"),Promise.resolve())).catch(t=>(this.emit("end-shuffle"),Promise.reject(t)))}_onExchange(t,e){const n=e.sample.slice(0),r=String(e.from),i=this._getSample(this.options.maxPeers);a("[%s] Answer to a an exchange demande with %s with a sample of size: %f",this.PEER,r,i.length),e.type="MExchangeBack",e.sample=i,e.from=this.getInviewId(),this.send(t,e,this.options.retry);const s=n.filter(t=>!this._partialView.has(t.id));for(let e=0;e<s.length;e++){const n=s[e];if(this._partialView.size>=this.options.maxPeers){const t=Math.floor(Math.random()*i.length),e=i[t].id;i.splice(t,1),a("[%s] replacing entry %s by %s",this.PEER,e,n.id),this.disconnect(e),this._partialView.removeAll(e)}this.send(t,{type:"MBridge",from:this.getInviewId(),to:n.id},this.options.retry).then(()=>{}).catch(t=>{})}}_getSample(t){let e=[],n=[];this._partialView.forEach((t,e)=>{n.push({id:e,age:t[0]})});const r=Math.min(n.length,t);for(;e.length<r;){const t=Math.floor(Math.random()*n.length);e.push(n[t]),n.splice(t,1)}return e}getPeers(t){let e=[];if(void 0===t)this._partialView.forEach((t,n)=>{e.push(n)});else{let n=[];for(this._partialView.forEach((t,e)=>n.push(e));e.length<t&&n.length>0;){let t=Math.floor(Math.random()*n.length);e.push(n[t]),n.splice(t,1)}let r=[];for(this.i.forEach((t,e)=>r.push(e));e.length<t&&r.length>0;){let t=Math.floor(Math.random()*r.length);e.push(r[t]),r.splice(t,1)}}return e}_onBridge(t,e){t!==e&&this.connect(t,e)}_onArcDown(t){a("[%s] ONARCDOWN ==> %s =X> %s",this.PID,this.PEER,t||"unknown")}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e){this.source=t,this.message=e}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.source=t,this.message=e,this.reason=n}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.source=t,this.message="Partial view is used as it was not empty, yet it is."}}},function(t,e,n){"use strict";t.exports=class{constructor(){this.type="MLeave"}}},function(t,e,n){"use strict";t.exports=class{constructor(){this.type="MJoin"}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.inview=t,this.type="MExchange"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e="unknown"){this.source=t,this.peer=e}}},function(t,e,n){"use strict";const r=n(85);t.exports=class extends Map{constructor(){super()}get oldest(){if(this.size<=0)throw new r("oldest");let t=null,e=0;return this.forEach((n,r)=>{e<=n[n.length-1]&&(t=r,e=n[n.length-1])}),t}increment(){this.forEach((t,e)=>{this.set(e,t.map(t=>t+1))})}add(t){!this.has(t)&&this.set(t,new Array),this.get(t).unshift(0)}removeYoungest(t){if(!this.has(t))throw new r("removeYoungest",t);this.get(t).shift(),0===this.get(t).length&&this.delete(t)}removeOldest(t){if(!this.has(t))throw new r("removeOldest",t);this.get(t).pop(),0===this.get(t).length&&this.delete(t)}removeAll(t){if(!this.has(t))throw new r("removeAll",t);const e=this.get(t).length;return this.delete(t),e}get leastFrequent(){let t=[],e=1/0;return this.forEach((n,r)=>{n.length<e&&(t=[],e=n.length),n.length===e&&t.push(r)}),t[Math.floor(Math.random()*t.length)]}}},function(t,e,n){"use strict";t.exports=class{constructor(){this.type="MDirect"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e){this.from=t,this.to=e,this.type="MConnectTo"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.from=t,this.to=e,this.message=n,this.type="MForwarded"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.from=t,this.to=e,this.message=n,this.type="MForwardTo"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.source=t,this.entry=e,this.message=n}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.pid=t,this.message="The idenfifier of the registering protocol already exists."}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.peer=t,this.pid=e,this.payload=n,this.type="MSend"}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r,i="init"){this.tid=t,this.peer=e,this.pid=n,this.offer=r,this.type="MRequest",this.offerType=i}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r,i="init"){this.tid=t,this.peer=e,this.pid=n,this.offer=r,this.type="MResponse",this.offerType=i}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r){this.peer=t,this.connect=e,this.disconnect=n,this.send=r}connect(t,e){this.connect(t,e)}disconnect(t){return this.disconnect(t)}send(t,e,n){return this.send(t,e)}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.peer=t,this.socket=e,this.timeout=n}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r,i){this.tid=t,this.peer=e,this.pid=n,this.socket=r,this.successful=!1,this.alreadyExists=!1,this.timeout=i}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n,r){this.source=t,this.peer=e,this.protocolId=n,this.message=r}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.peer=t,this.socket=n,this.protocols=new Map,this.increment(e)}increment(t){this.protocols.has(t)||this.protocols.set(t,0),this.protocols.set(t,this.protocols.get(t)+1)}decrement(t){let e=!1;return this.protocols.has(t)&&(this.protocols.set(t,this.protocols.get(t)-1),this.protocols.get(t)<=0&&this.protocols.delete(t),e=!0),e}sum(){let t=0;return this.protocols.forEach((e,n)=>{t+=e}),t}}},function(t,e,n){"use strict";const r=n(100),i=n(99);t.exports=class{constructor(){this.store=new Map}insert(t,e,n){if(null===n&&!this.store.has(t))throw new i("arcStore",t,e,"Try to add an arc to a peer that does not exists");if(this.store.has(t))this.store.get(t).increment(e);else{let i=new r(t,e,n);this.store.set(t,i)}}remove(t,e){let n=null;if(!this.store.has(t))throw new i("arcStore",t,e,"Try to remove an arc to a peer that does not exists");if(!this.store.get(t).decrement(e))throw new i("arcStore",t,e,"Try to remove an arc from a protocol that does not have this arc");return this.store.get(t).sum()<=0&&(n=this.store.get(t),this.store.delete(t)),n}removeAll(t){let e=[];return this.store.forEach((n,r)=>{if(n.protocols.has(t)){let i=n.protocols.get(t),s={peer:n.peer,socket:null,occ:i};for(let n=0;n<i;++n){let n=this.remove(r,t);null!==n&&(s.socket=n.socket,e.push(s))}}}),e}removePeer(t){let e;return this.store.has(t)?(e=this.store.get(t).protocols,this.store.delete(t)):e=new Map,e}contains(t){return this.store.has(t)}get(t){let e=null;return this.contains(t)&&(e=this.store.get(t)),e}}},function(t,e,n){"use strict";(function(e,r){var i=n(14).Buffer,s=e.crypto||e.msCrypto;s&&s.getRandomValues?t.exports=function(t,n){if(t>65536)throw new Error("requested too many random bytes");var o=new e.Uint8Array(t);t>0&&s.getRandomValues(o);var a=i.from(o.buffer);return"function"==typeof n?r.nextTick(function(){n(null,a)}):a}:t.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,n(0),n(7))},function(t,e){t.exports=function(){if("undefined"==typeof window)return null;var t={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return t.RTCPeerConnection?t:null}},function(t,e,n){(function(e){t.exports=c;var r=n(1)("simple-peer"),i=n(103),s=n(5),o=n(102),a=n(6);function c(t){var e=this;if(!(e instanceof c))return new c(t);if(e._id=o(4).toString("hex").slice(0,7),e._debug("new peer %o",t),t=Object.assign({allowHalfOpen:!1},t),a.Duplex.call(e,t),e.channelName=t.initiator?t.channelName||o(20).toString("hex"):null,e._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,e.initiator=t.initiator||!1,e.channelConfig=t.channelConfig||c.channelConfig,e.config=t.config||c.config,e.constraints=e._transformConstraints(t.constraints||c.constraints),e.offerConstraints=e._transformConstraints(t.offerConstraints||{}),e.answerConstraints=e._transformConstraints(t.answerConstraints||{}),e.sdpTransform=t.sdpTransform||function(t){return t},e.streams=t.streams||(t.stream?[t.stream]:[]),e.trickle=void 0===t.trickle||t.trickle,e.destroyed=!1,e.connected=!1,e.remoteAddress=void 0,e.remoteFamily=void 0,e.remotePort=void 0,e.localAddress=void 0,e.localPort=void 0,e._wrtc=t.wrtc&&"object"==typeof t.wrtc?t.wrtc:i(),!e._wrtc)throw"undefined"==typeof window?h("No WebRTC support: Specify `opts.wrtc` option in this environment","ERR_WEBRTC_SUPPORT"):h("No WebRTC support: Not a supported browser","ERR_WEBRTC_SUPPORT");e._pcReady=!1,e._channelReady=!1,e._iceComplete=!1,e._channel=null,e._pendingCandidates=[],e._isNegotiating=!1,e._batchedNegotiation=!1,e._queuedNegotiation=!1,e._sendersAwaitingStable=[],e._senderMap=new WeakMap,e._remoteTracks=[],e._remoteStreams=[],e._chunk=null,e._cb=null,e._interval=null,e._pc=new e._wrtc.RTCPeerConnection(e.config,e.constraints),e._isReactNativeWebrtc="number"==typeof e._pc._peerConnectionId,e._pc.oniceconnectionstatechange=function(){e._onIceStateChange()},e._pc.onicegatheringstatechange=function(){e._onIceStateChange()},e._pc.onsignalingstatechange=function(){e._onSignalingStateChange()},e._pc.onicecandidate=function(t){e._onIceCandidate(t)},e.initiator?e._setupData({channel:e._pc.createDataChannel(e.channelName,e.channelConfig)}):e._pc.ondatachannel=function(t){e._setupData(t)},"addTrack"in e._pc&&(e.streams&&e.streams.forEach(function(t){e.addStream(t)}),e._pc.ontrack=function(t){e._onTrack(t)}),e.initiator&&e._needsNegotiation(),e._onFinishBound=function(){e._onFinish()},e.once("finish",e._onFinishBound)}function h(t,e){var n=new Error(t);return n.code=e,n}function u(){}s(c,a.Duplex),c.WEBRTC_SUPPORT=!!i(),c.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},c.constraints={},c.channelConfig={},Object.defineProperty(c.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),c.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},c.prototype.signal=function(t){var e=this;if(e.destroyed)throw h("cannot signal after peer is destroyed","ERR_SIGNALING");if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}e._debug("signal()"),t.renegotiate&&(e._debug("got request to renegotiate"),e._needsNegotiation()),t.candidate&&(e._pc.remoteDescription&&e._pc.remoteDescription.type?e._addIceCandidate(t.candidate):e._pendingCandidates.push(t.candidate)),t.sdp&&e._pc.setRemoteDescription(new e._wrtc.RTCSessionDescription(t),function(){e.destroyed||(e._pendingCandidates.forEach(function(t){e._addIceCandidate(t)}),e._pendingCandidates=[],"offer"===e._pc.remoteDescription.type&&e._createAnswer())},function(t){e.destroy(h(t,"ERR_SET_REMOTE_DESCRIPTION"))}),t.sdp||t.candidate||t.renegotiate||e.destroy(h("signal() called with invalid signal data","ERR_SIGNALING"))},c.prototype._addIceCandidate=function(t){var e=this;try{e._pc.addIceCandidate(new e._wrtc.RTCIceCandidate(t),u,function(t){e.destroy(h(t,"ERR_ADD_ICE_CANDIDATE"))})}catch(t){e.destroy(h("error adding candidate: "+t.message,"ERR_ADD_ICE_CANDIDATE"))}},c.prototype.send=function(t){this._channel.send(t)},c.prototype.addStream=function(t){var e=this;e._debug("addStream()"),t.getTracks().forEach(function(n){e.addTrack(n,t)})},c.prototype.addTrack=function(t,e){this._debug("addTrack()");var n=this._pc.addTrack(t,e),r=this._senderMap.get(t)||new WeakMap;r.set(e,n),this._senderMap.set(t,r),this._needsNegotiation()},c.prototype.removeTrack=function(t,e){this._debug("removeSender()");var n=this._senderMap.get(t),r=n?n.get(e):null;r||this.destroy(new Error("Cannot remove track that was never added."));try{this._pc.removeTrack(r)}catch(t){"NS_ERROR_UNEXPECTED"===t.name?this._sendersAwaitingStable.push(r):this.destroy(t)}},c.prototype.removeStream=function(t){var e=this;e._debug("removeSenders()"),t.getTracks().forEach(function(n){e.removeTrack(n,t)})},c.prototype._needsNegotiation=function(){var t=this;t._debug("_needsNegotiation"),t._batchedNegotiation||(t._batchedNegotiation=!0,setTimeout(function(){t._batchedNegotiation=!1,t._debug("starting batched negotiation"),t.negotiate()},0))},c.prototype.negotiate=function(){this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),this._createOffer()):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0},c.prototype.destroy=function(t){this._destroy(t,function(){})},c.prototype._destroy=function(t,e){if(!this.destroyed){if(this._debug("destroy (error: %s)",t&&(t.message||t)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this.connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(t){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(t){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,"addTrack"in this._pc&&(this._pc.ontrack=null),this._pc.ondatachannel=null}this._pc=null,this._channel=null,t&&this.emit("error",t),this.emit("close"),e()}},c.prototype._setupData=function(t){var e=this;if(!t.channel)return e.destroy(h("Data channel event is missing `channel` property","ERR_DATA_CHANNEL"));e._channel=t.channel,e._channel.binaryType="arraybuffer","number"==typeof e._channel.bufferedAmountLowThreshold&&(e._channel.bufferedAmountLowThreshold=65536),e.channelName=e._channel.label,e._channel.onmessage=function(t){e._onChannelMessage(t)},e._channel.onbufferedamountlow=function(){e._onChannelBufferedAmountLow()},e._channel.onopen=function(){e._onChannelOpen()},e._channel.onclose=function(){e._onChannelClose()},e._channel.onerror=function(t){e.destroy(h(t,"ERR_DATA_CHANNEL"))}},c.prototype._read=function(){},c.prototype._write=function(t,e,n){if(this.destroyed)return n(h("cannot write after peer is destroyed","ERR_DATA_CHANNEL"));if(this.connected){try{this.send(t)}catch(t){return this.destroy(h(t,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=t,this._cb=n},c.prototype._onFinish=function(){var t=this;function e(){setTimeout(function(){t.destroy()},1e3)}t.destroyed||(t.connected?e():t.once("connect",e))},c.prototype._createOffer=function(){var t=this;t.destroyed||t._pc.createOffer(function(e){function n(){var n=t._pc.localDescription||e;t._debug("signal"),t.emit("signal",{type:n.type,sdp:n.sdp})}t.destroyed||(e.sdp=t.sdpTransform(e.sdp),t._pc.setLocalDescription(e,function(){t._debug("createOffer success"),t.destroyed||(t.trickle||t._iceComplete?n():t.once("_iceComplete",n))},function(e){t.destroy(h(e,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(e){t.destroy(h(e,"ERR_CREATE_OFFER"))},t.offerConstraints)},c.prototype._createAnswer=function(){var t=this;t.destroyed||t._pc.createAnswer(function(e){function n(){var n=t._pc.localDescription||e;t._debug("signal"),t.emit("signal",{type:n.type,sdp:n.sdp})}t.destroyed||(e.sdp=t.sdpTransform(e.sdp),t._pc.setLocalDescription(e,function(){t.destroyed||(t.trickle||t._iceComplete?n():t.once("_iceComplete",n))},function(e){t.destroy(h(e,"ERR_SET_LOCAL_DESCRIPTION"))}))},function(e){t.destroy(h(e,"ERR_CREATE_ANSWER"))},t.answerConstraints)},c.prototype._onIceStateChange=function(){if(!this.destroyed){var t=this._pc.iceConnectionState,e=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,e),this.emit("iceStateChange",t,e),"connected"!==t&&"completed"!==t||(this._pcReady=!0,this._maybeReady()),"failed"===t&&this.destroy(h("Ice connection failed.","ERR_ICE_CONNECTION_FAILURE")),"closed"===t&&this.destroy(new Error("Ice connection closed."))}},c.prototype.getStats=function(t){var e=this;0===e._pc.getStats.length?e._pc.getStats().then(function(e){var n=[];e.forEach(function(t){n.push(t)}),t(null,n)},function(e){t(e)}):e._isReactNativeWebrtc?e._pc.getStats(null,function(e){var n=[];e.forEach(function(t){n.push(t)}),t(null,n)},function(e){t(e)}):e._pc.getStats.length>0?e._pc.getStats(function(n){if(!e.destroyed){var r=[];n.result().forEach(function(t){var e={};t.names().forEach(function(n){e[n]=t.stat(n)}),e.id=t.id,e.type=t.type,e.timestamp=t.timestamp,r.push(e)}),t(null,r)}},function(e){t(e)}):t(null,[])},c.prototype._maybeReady=function(){var t=this;t._debug("maybeReady pc %s channel %s",t._pcReady,t._channelReady),!t.connected&&!t._connecting&&t._pcReady&&t._channelReady&&(t._connecting=!0,function e(){t.destroyed||t.getStats(function(n,r){if(!t.destroyed){n&&(r=[]);var i={},s={},o={},a=!1;if(r.forEach(function(t){"remotecandidate"!==t.type&&"remote-candidate"!==t.type||(i[t.id]=t),"localcandidate"!==t.type&&"local-candidate"!==t.type||(s[t.id]=t),"candidatepair"!==t.type&&"candidate-pair"!==t.type||(o[t.id]=t)}),r.forEach(function(t){"transport"===t.type&&t.selectedCandidatePairId&&u(o[t.selectedCandidatePairId]),("googCandidatePair"===t.type&&"true"===t.googActiveConnection||("candidatepair"===t.type||"candidate-pair"===t.type)&&t.selected)&&u(t)}),a||Object.keys(o).length&&!Object.keys(s).length){if(t._connecting=!1,t.connected=!0,t._chunk){try{t.send(t._chunk)}catch(n){return t.destroy(h(n,"ERR_DATA_CHANNEL"))}t._chunk=null,t._debug('sent chunk from "write before connect"');var c=t._cb;t._cb=null,c(null)}"number"!=typeof t._channel.bufferedAmountLowThreshold&&(t._interval=setInterval(function(){t._onInterval()},150),t._interval.unref&&t._interval.unref()),t._debug("connect"),t.emit("connect")}else setTimeout(e,100)}function u(e){a=!0;var n=s[e.localCandidateId];n&&n.ip?(t.localAddress=n.ip,t.localPort=Number(n.port)):n&&n.ipAddress?(t.localAddress=n.ipAddress,t.localPort=Number(n.portNumber)):"string"==typeof e.googLocalAddress&&(n=e.googLocalAddress.split(":"),t.localAddress=n[0],t.localPort=Number(n[1]));var r=i[e.remoteCandidateId];r&&r.ip?(t.remoteAddress=r.ip,t.remotePort=Number(r.port)):r&&r.ipAddress?(t.remoteAddress=r.ipAddress,t.remotePort=Number(r.portNumber)):"string"==typeof e.googRemoteAddress&&(r=e.googRemoteAddress.split(":"),t.remoteAddress=r[0],t.remotePort=Number(r[1])),t.remoteFamily="IPv4",t._debug("connect local: %s:%s remote: %s:%s",t.localAddress,t.localPort,t.remoteAddress,t.remotePort)}})}())},c.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()},c.prototype._onSignalingStateChange=function(){var t=this;t.destroyed||("stable"===t._pc.signalingState&&(t._isNegotiating=!1,t._debug("flushing sender queue",t._sendersAwaitingStable),t._sendersAwaitingStable.forEach(function(e){t.removeTrack(e),t._queuedNegotiation=!0}),t._sendersAwaitingStable=[],t._queuedNegotiation&&(t._debug("flushing negotiation queue"),t._queuedNegotiation=!1,t._needsNegotiation()),t._debug("negotiate"),t.emit("negotiate")),t._debug("signalingStateChange %s",t._pc.signalingState),t.emit("signalingStateChange",t._pc.signalingState))},c.prototype._onIceCandidate=function(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):t.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},c.prototype._onChannelMessage=function(t){if(!this.destroyed){var n=t.data;n instanceof ArrayBuffer&&(n=e.from(n)),this.push(n)}},c.prototype._onChannelBufferedAmountLow=function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var t=this._cb;this._cb=null,t(null)}},c.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},c.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this.destroy())},c.prototype._onTrack=function(t){var e=this;e.destroyed||t.streams.forEach(function(n){e._debug("on track"),e.emit("track",t.track,n),e._remoteTracks.push({track:t.track,stream:n}),e._remoteStreams.some(function(t){return t.id===n.id})||(e._remoteStreams.push(n),setTimeout(function(){e.emit("stream",n)},0))})},c.prototype._debug=function(){var t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],r.apply(null,t)},c.prototype._transformConstraints=function(t){if(0===Object.keys(t).length)return t;if((t.mandatory||t.optional)&&!this._isChromium){var e=Object.assign({},t.optional,t.mandatory);return void 0!==e.OfferToReceiveVideo&&(e.offerToReceiveVideo=e.OfferToReceiveVideo,delete e.OfferToReceiveVideo),void 0!==e.OfferToReceiveAudio&&(e.offerToReceiveAudio=e.OfferToReceiveAudio,delete e.OfferToReceiveAudio),e}return t.mandatory||t.optional||!this._isChromium?t:(void 0!==t.offerToReceiveVideo&&(t.OfferToReceiveVideo=t.offerToReceiveVideo,delete t.offerToReceiveVideo),void 0!==t.offerToReceiveAudio&&(t.OfferToReceiveAudio=t.offerToReceiveAudio,delete t.offerToReceiveAudio),{mandatory:t})}}).call(this,n(11).Buffer)},function(t,e,n){"use strict";const r=n(1)("neighborhood-wrtc"),i=n(2),s=n(4),o=n(104),a=n(101),c=n(98),h=n(97),u=n(96),l=n(95),f=n(94),p=n(93),d=n(92),g=n(91);t.exports=class{constructor(t){this.options={socketClass:o,peer:s(),config:{iceServers:[],trickle:!0,initiator:!1},timeout:6e4,pendingTimeout:1e4,encoding:t=>JSON.stringify(t),decoding:t=>JSON.parse(t)},this.options=i(this.options,t),this.encode=this.options.encoding,this.decode=this.options.decoding,this.PEER=this.options.peer,r("[%s] initialized.",this.PEER),this.pending=new Map,this.living=new a,this.dying=new Map,this.protocols=new Map}register(t){if(this.protocols.has(t._pid()))throw new d(t._pid());return r("[%s] protocol %s just registered.",this.PEER,t._pid()),this.protocols.set(t._pid(),t),new u(this.PEER,this._connect.bind(this,t._pid()),this._disconnect.bind(this,t._pid()),this._send.bind(this,t._pid()))}_connect(t,e,n){"function"==typeof e&&void 0===n?this._initiate(t,e):"function"==typeof e&&void 0!==n?this._accept(t,e,n):this._finalize(t,e)}_initiate(t,e){this.options.config.initiator=!0;let n=new(0,this.options.socketClass)(this.options.config),i=new c(s(),null,t,n);this.pending.set(i.tid,i),n.once("connect",()=>{i.successful=!0,this.living.contains(i.peer)?(i.alreadyExists=!0,i.successful=!0,this.living.insert(i.peer,t),r("[%s] --- arc --\x3e %s",this.PEER,i.peer),this.protocols.get(t)._connected(i.peer,!0),i.peer=null):(this.living.insert(i.peer,t,n),r("[%s] --- WebRTC --\x3e %s",this.PEER,i.peer),this.protocols.get(t)._connected(i.peer,!0)),this._checkPendingEntry(i)}),n.once("close",()=>{if(null!==i.peer){if(this.living.contains(i.peer))this.living.removePeer(i.peer).forEach((t,e)=>{for(let n=0;n<t;++n)this.protocols.get(e)._disconnected(i.peer)});else if(this.dying.has(i.peer)){let t=this.dying.get(i.peer);clearTimeout(t.timeout),this.dying.delete(i.peer)}r("[%s] -‡- WebRTC -‡> %s",this.PEER,i.peer)}else r("[%s] -‡- WebRTC -‡> %s",this.PEER,"unknown");this._checkPendingEntry(i)}),n.on("data",t=>{let e=this.decode(t);this.protocols.get(e.pid)._received(e.peer,e.payload)}),n.on("stream",t=>{this.protocols.get(i.pid)._streamed(i.peer,t)}),n.on("error",t=>{r(t),n.destroy()}),n.on("signal",r=>{n.connected&&n._isNegotiating?e(new f(i.tid,this.PEER,t,r,"renegociate")):e(new f(i.tid,this.PEER,t,r))}),setTimeout(()=>{(!i.successful||i.alreadyExists)&&null!==i.socket&&i.socket.destroy(),!i.successful&&this.protocols.get(t)._failed(i.peer,!0),this.pending.delete(i.tid)},this.options.pendingTimeout)}_finalize(t,e){if("renegociate"===e.offerType){if(r("[%s] _finalize regenociation:",e),this.living.store.has(e.peer)){const t=this.living.get(e.peer).socket;t.connected&&!t._isNegociating&&t.signal(e.offer)}return}if(!this.pending.has(e.tid))return;let n=this.pending.get(e.tid);if(n&&(n.alreadyExists||n.successful))return this._checkPendingEntry(n),void r("The socket already exists: ",n.peer);if(this.living.contains(e.peer))n.alreadyExists=!0,n.successful=!0,this.living.insert(e.peer,t),r("[%s] --- arc --\x3e %s",this.PEER,e.peer),this.protocols.get(t)._connected(e.peer,!0),this._checkPendingEntry(n);else if(this.dying.has(e.peer)){n.alreadyExists=!0,n.successful=!0;let i=this.dying.get(e.peer);clearTimeout(i.timeout),this.dying.delete(e.peer),this.living.insert(e.peer,t,i.socket),r("[%s] -¡- arc -¡> %s",this.PEER,e.peer),this.protocols.get(t)._connected(e.peer,!0),this._checkPendingEntry(n)}else{if(n.peer=e.peer,!e.offer)throw new g("_finalize",n,e);n.socket.signal(e.offer)}}_accept(t,e,n){if("renegociate"===n.offerType)return r("[%s] _accept regenociation:",n),void(this.living.store.has(n.peer)&&this.living.get(n.peer).socket.signal(n.offer));let i=!1;const s=n.tid,o=n.peer;if(!this.pending.has(s)){i=!0;let e=new c(s,o,t);this.pending.set(s,e),setTimeout(()=>{(!e.successful||e.alreadyExists)&&e.socket&&e.socket.destroy(),!e.successful&&this.protocols.get(t)._failed(o,!1),this.pending.delete(s)},this.options.pendingTimeout)}let a=this.pending.get(n.tid);if(!a.alreadyExists&&!a.successful)if(this.living.contains(n.peer))a.alreadyExists=!0,a.successful=!0,this.living.insert(n.peer,t),r("[%s] <-- arc --- %s",this.PEER,a.peer),this.protocols.get(t)._connected(n.peer,!1),i&&e(new l(a.tid,this.PEER,t,null)),this._checkPendingEntry(a);else if(this.dying.has(n.peer)){a.alreadyExists=!0,a.successful=!0;let s=this.dying.get(n.peer);clearTimeout(s.timeout),this.dying.delete(n.peer),this.living.insert(n.peer,t,s.socket),r("[%s] <¡- arc -¡- %s",this.PEER,n.peer),this.protocols.get(t)._connected(n.peer,!1),i&&e(new l(a.tid,this.PEER,t,null)),this._checkPendingEntry(a)}else{if(i&&!a.socket){this.options.config.initiator=!1;let n=new(0,this.options.socketClass)(this.options.config);a.socket=n,n.once("connect",()=>{a.successful=!0,this.living.contains(a.peer)?(a.alreadyExists=!0,a.successful=!0,this.living.insert(a.peer,t),r("[%s] <-- arc --- %s",this.PEER,a.peer),this.protocols.get(t)._connected(a.peer,!1),a.peer=null):(this.living.insert(a.peer,t,n),r("[%s] <-- WebRTC --- %s",this.PEER,a.peer),this.protocols.get(t)._connected(a.peer,!1)),this._checkPendingEntry(a)}),n.once("close",()=>{if(null!==a.peer){if(this.living.contains(a.peer))this.living.removePeer(a.peer).forEach((t,e)=>{for(let n=0;n<t;++n)this.protocols.get(e)._disconnected(a.peer)});else if(this.dying.has(a.peer)){let t=this.dying.get(a.peer);clearTimeout(t.timeout),this.dying.delete(a.peer)}r("[%s] <‡- WebRTC -‡- %s",this.PEER,a.peer)}else r("[%s] <‡- WebRTC -‡- %s",this.PEER,"unknown");this._checkPendingEntry(a)}),n.on("data",t=>{let e=this.decode(t);this.protocols.get(e.pid)._received(e.peer,e.payload)}),n.on("stream",t=>{this.protocols.get(a.pid)._streamed(a.peer,t)}),n.on("error",t=>{r(t),n.destroy()}),n.on("signal",r=>{n.connected&&!n._isNegotiating?e(new l(a.tid,this.PEER,t,r,"renegociate")):e(new l(a.tid,this.PEER,t,r))})}a.socket.signal(n.offer)}}_disconnect(t,e){if(void 0===e)this.living.removeAll(t).forEach(n=>{if(null!==n.socket){var i=new h(n.peer,n.socket,setTimeout(()=>{n.socket&&n.socket.destroy()},this.options.timeout));this.dying.set(i.peer,i)}for(let i=0;i<n.occ;++i)null===n.socket||null!==n.socket&&i<n.occ-1?r("[%s] ††† arc ††† %s",this.PEER,e):r("[%s] ††† WebRTC ††† %s",this.PEER,e),this.protocols.get(t)._disconnected(n.peer)});else{var n=null;try{n=this.living.remove(e,t)}catch(t){console.log(t)}if(n){var i=new h(n.peer,n.socket,setTimeout(()=>{n.socket&&n.socket.destroy()},this.options.timeout));this.dying.set(i.peer,i),r("[%s] ††† WebRTC ††† %s",this.PEER,e)}else r("[%s] ††† arc ††† %s",this.PEER,e);this.protocols.get(t)._disconnected(e)}}_send(t,e,n,i=0){return new Promise((s,o)=>{let a=null;this.living.contains(e)?a=this.living.get(e):this.dying.has(e)&&(a=this.dying.get(e)),null===a&&o(new Error("peer not found: "+e));let c=h=>{try{a.socket.send(this.encode(new p(this.PEER,t,n))),r("[%s] --- msg --\x3e %s:%s",this.PEER,e,t),s()}catch(n){r("[%s] -X- msg -X> %s:%s",this.PEER,e,t),h<i?setTimeout(()=>{c(h+1)},1e3):o(n)}};c(0)})}_checkPendingEntry(t){this.pending.has(t.tid)&&(null===t.peer&&t.socket&&(t.socket.destroy(),t.socket=null),this.pending.delete(t.tid))}}},function(t,e,n){"use strict";const r=n(1)("spray-wrtc"),i=n(19),s=n(2),o=n(86),a=n(84),c=n(83),h=n(82),u=(n(81),n(80)),l=n(79);t.exports=class extends i{constructor(t={}){super(s({pid:"spray-wrtc",delta:12e4,timeout:6e4,a:1,b:0,retry:5},t)),r("[%s] Initalized with ==> %s ==>",this.PID,this.PEER),this.partialView=new o,this.state="disconnected",this.periodic=null,this.on("receive",(t,e)=>this._receive(t,e)),this.on("open",t=>{this._open(t),this._updateState()}),this.on("close",t=>{this._close(t),this._updateState()}),this.on("fail",t=>{this._onArcDown(t),this._updateState()})}_start(t=this.options.delta){this.periodic=setInterval(()=>{this._exchange()},t)}_stop(){clearInterval(this.periodic)}_receive(t,e){if(e.type&&"MExchange"===e.type)this._onExchange(t,e);else if(e.type&&"MJoin"===e.type)this._onJoin(t);else{if(!e.type||"MLeave"!==e.type)throw new u("_receive",e,"unhandled");this._onLeave(t)}}_open(t){r("[%s] %s ===> %s",this.PID,this.PEER,t),this.partialView.add(t)}_close(t){r("[%s] %s =†=> %s",this.PID,this.PEER,t)}_updateState(){const t=this.state;this.i.size>0&&this.o.size>0&&"connected"!==t?this.state="connected":(this.i.size>0&&this.o.size<=0||this.o.size>0&&this.i.size<=0)&&"partially connected"!==t?this.state="partially connected":this.i.size<=0&&this.o.size<=0&&"disconnected"!==t&&(this.state="disconnected"),t!==this.state&&this.emit("statechange",this.state)}join(t){let e=new Promise((t,e)=>{"disconnected"!==this.state&&e(new l("join","Already connected."));let n=setTimeout(()=>{e(new l("join","Timeout exceeded."))},this.options.timeout);this.once("open",r=>{this.send(r,new c,this.options.retry).then(()=>{clearTimeout(n),this._start(),this._inject(this.options.a-1,0,r),t(r)}).catch(()=>{e(new l("join","Could not notify remote contact."))})})});return this.connect(t),e}_onJoin(t){this.partialView.size>0?(r("[%s] %s ===> join %s ===> %s neighbors",this.PID,t,this.PEER,this.partialView.size),this.partialView.forEach((e,n)=>{e.forEach(e=>{this.connect(n,t)})})):(r("[%s] %s ===> join %s ===> %s",this.PID,t,this.PEER,t),this._inject(2*this.options.a,2*this.options.b,t),this._start())}leave(t=0){const e=this.NI.options.timeout,n=this.NO.options.timeout;if(this.NI.options.timeout=t,this.NO.options.timeout=t,this._stop(),t>0){let t=[];this.getInview().forEach((e,n)=>t.push(n));let e=this.getOutview(),n=[];e.forEach((t,e)=>n.push(e));let r=e.size-this.options.a;for(let e=0;e<Math.floor(r);++e){const e=Math.floor(Math.random()*t.length);let r=n.filter(n=>n!==t[e]);if(r.length>0){const n=Math.floor(Math.random()*r.length);this.connect(t[e],r[n])}}t.forEach(t=>{this.send(t,new h,this.options.retry).catch(t=>{})}),n.forEach(t=>{this._onLeave(t)})}else this.partialView.clear(),this.disconnect();this.NI.options.timeout=e,this.NO.options.timeout=n}_onLeave(t){if(this.partialView.has(t)){r("[%s] %s ==> ††† %s †††",this.PID,this.PEER,t);const e=this.partialView.removeAll(t);for(let n=0;n<e;++n)this.disconnect(t)}}getPeers(t){let e=[];if(void 0===t)this.partialView.forEach((t,n)=>{e.push(n)});else{let n=[];for(this.partialView.forEach((t,e)=>n.push(e));e.length<t&&n.length>0;){let t=Math.floor(Math.random()*n.length);e.push(n[t]),n.splice(t,1)}let r=[];for(this.i.forEach((t,e)=>r.push(e));e.length<t&&r.length>0;){let t=Math.floor(Math.random()*r.length);e.push(r[t]),r.splice(t,1)}}return r("[%s] %s provides %s peers",this.PID,this.PEER,e.length),e}_checkPartialView(){let t=[];this.partialView.forEach((e,n)=>{this.o.has(n)||t.push(n)}),t.forEach(t=>{this._onPeerDown(t)})}_getSample(t){let e=[],n=[];this.partialView.forEach((t,e)=>{t.forEach(t=>{n.push(e)})});const r=Math.ceil(n.length/2);for(void 0!==t&&(n.splice(n.indexOf(t),1),e.push(t));e.length<r;){const t=Math.floor(Math.random()*n.length);e.push(n[t]),n.splice(t,1)}return e}_exchange(){if(this._checkPartialView(),this.partialView.size<=0)return;this.partialView.increment();const t=this.partialView.oldest;this.send(t,new a(this.getInviewId()),this.options.retry).then(()=>{let e=this._getSample(t);r("[%s] %s ==> exchange %s ==> %s",this.PID,this.PEER,e.length,t),(e=e.map(e=>e===t&&this.getInviewId()||e)).forEach(e=>{this.connect(t,e)}),(e=e.map(e=>e===this.getInviewId()&&t||e)).forEach(e=>{this.disconnect(e),e===t?this.partialView.removeOldest(e):this.partialView.removeYoungest(e)})}).catch(e=>{r("[%s] %s =X> exchange =X> %s",this.PID,this.PEER,t),this._onPeerDown(t)})}_onExchange(t,e){this._checkPartialView(),this.partialView.increment();let n=this._getSample();r("[%s] %s ==> exchange %s ==> %s",this.PID,t,n.length,this.PEER),(n=n.map(t=>t===e.inview&&this.getInviewId()||t)).forEach(e=>{this.connect(t,e)}),(n=n.map(t=>t===this.getInviewId()&&e.inview||t)).forEach(t=>{this.disconnect(t),this.partialView.removeYoungest(t)})}_onPeerDown(t){r("[%s] ==> %s ==> XXX %s XXX",this.PID,this.PEER,t);const e=this.partialView.removeAll(t),n=this.options.a/(this.partialView.size+e);if(this.partialView.size>0)for(let t=0;t<e;++t)Math.random()>n&&this.connect(null,this.partialView.leastFrequent)}_onArcDown(t){r("[%s] ==> %s =X> %s",this.PID,this.PEER,t||"unknown"),this.partialView.size>0&&this.connect(null,this.partialView.leastFrequent)}_inject(t,e,n){let r=t;for(let e=0;e<Math.floor(t);++e)this.connect(null,n),r-=1;Math.random()<r&&this.connect(null,n);let i=e;for(let t=0;t<Math.floor(e);++t)this.connect(null,n),i-=1;Math.random()<i&&this.connect(null,n)}}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}},function(t,e){t.exports=function(t,e){for(var n=[],r=(e=e||0)||0;r<t.length;r++)n[r-e]=t[r];return n}},function(t,e){},function(t,e,n){(function(e){var r,i=n(20),s=n(9),o=n(16),a=n(15),c=n(34),h=n(1)("engine.io-client:websocket"),u=e.WebSocket||e.MozWebSocket;if("undefined"==typeof window)try{r=n(109)}catch(t){}var l=u;function f(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=u&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(l=r),i.call(this,t)}l||"undefined"!=typeof window||(l=r),t.exports=f,a(f,i),f.prototype.name="websocket",f.prototype.supportsBinary=!0,f.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?e?new l(t,e):new l(t):new l(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},f.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},f.prototype.write=function(t){var n=this;this.writable=!1;for(var r=t.length,i=0,o=r;i<o;i++)!function(t){s.encodePacket(t,n.supportsBinary,function(i){if(!n.usingBrowserWebSocket){var s={};t.options&&(s.compress=t.options.compress),n.perMessageDeflate&&("string"==typeof i?e.Buffer.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(s.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,s)}catch(t){h("websocket closed before onclose event")}--r||(n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0))})}(t[i])},f.prototype.onClose=function(){i.prototype.onClose.call(this)},f.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},f.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||(t.b64=1),(t=o.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},f.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===f.prototype.name)}}).call(this,n(0))},function(t,e,n){(function(e){var r=n(36),i=n(15);t.exports=h;var s,o=/\n/g,a=/\\n/g;function c(){}function h(t){r.call(this,t),this.query=this.query||{},s||(e.___eio||(e.___eio=[]),s=e.___eio),this.index=s.length;var n=this;s.push(function(t){n.onData(t)}),this.query.j=this.index,e.document&&e.addEventListener&&e.addEventListener("beforeunload",function(){n.script&&(n.script.onerror=c)},!1)}i(h,r),h.prototype.supportsBinary=!1,h.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},h.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},h.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r,i=document.createElement("form"),s=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),s.name="d",i.appendChild(s),document.body.appendChild(i),this.form=i,this.area=s}function h(){u(),e()}function u(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(t)}catch(t){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),u(),t=t.replace(a,"\\\n"),this.area.value=t.replace(o,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&h()}:this.iframe.onload=h}}).call(this,n(0))},function(t,e,n){(function(e){var n=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),i=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),s=n&&n.prototype.append&&n.prototype.getBlob;function o(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}t[e]=r}}}t.exports=r?i?e.Blob:function(t,e){return o(t),new Blob(t,e||{})}:s?function(t,e){e=e||{};var r=new n;o(t);for(var i=0;i<t.length;i++)r.append(t[i]);return e.type?r.getBlob(e.type):r.getBlob()}:void 0}).call(this,n(0))},function(t,e){!function(){"use strict";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),i=r.length,s="";for(n=0;n<i;n+=3)s+=t[r[n]>>2],s+=t[(3&r[n])<<4|r[n+1]>>4],s+=t[(15&r[n+1])<<2|r[n+2]>>6],s+=t[63&r[n+2]];return i%3==2?s=s.substring(0,s.length-1)+"=":i%3==1&&(s=s.substring(0,s.length-2)+"=="),s},e.decode=function(t){var e,r,i,s,o,a=.75*t.length,c=t.length,h=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(e=0;e<c;e+=4)r=n[t.charCodeAt(e)],i=n[t.charCodeAt(e+1)],s=n[t.charCodeAt(e+2)],o=n[t.charCodeAt(e+3)],l[h++]=r<<2|i>>4,l[h++]=(15&i)<<4|s>>2,l[h++]=(3&s)<<6|63&o;return u}}()},function(t,e,n){(function(t,r){var i;/*! https://mths.be/utf8js v2.1.2 by @mathias */!function(s){var o=("object"==typeof t&&t&&t.exports,"object"==typeof r&&r);o.global!==o&&o.window;var a,c,h,u=String.fromCharCode;function l(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function f(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function p(t,e){return u(t>>e&63|128)}function d(t,e){if(0==(4294967168&t))return u(t);var n="";return 0==(4294965248&t)?n=u(t>>6&31|192):0==(4294901760&t)?(f(t,e)||(t=65533),n=u(t>>12&15|224),n+=p(t,6)):0==(4292870144&t)&&(n=u(t>>18&7|240),n+=p(t,12),n+=p(t,6)),n+u(63&t|128)}function g(){if(h>=c)throw Error("Invalid byte index");var t=255&a[h];if(h++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function y(t){var e,n;if(h>c)throw Error("Invalid byte index");if(h==c)return!1;if(e=255&a[h],h++,0==(128&e))return e;if(192==(224&e)){if((n=(31&e)<<6|g())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&e)){if((n=(15&e)<<12|g()<<6|g())>=2048)return f(n,t)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(n=(7&e)<<18|g()<<12|g()<<6|g())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var m={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,r=l(t),i=r.length,s=-1,o="";++s<i;)o+=d(r[s],n);return o},decode:function(t,e){var n=!1!==(e=e||{}).strict;a=l(t),c=a.length,h=0;for(var r,i=[];!1!==(r=y(n));)i.push(r);return function(t){for(var e,n=t.length,r=-1,i="";++r<n;)(e=t[r])>65535&&(i+=u((e-=65536)>>>10&1023|55296),e=56320|1023&e),i+=u(e);return i}(i)}};void 0===(i=function(){return m}.call(e,n,e,t))||(t.exports=i)}()}).call(this,n(18)(t),n(0))},function(t,e){function n(){}t.exports=function(t,e,r){var i=!1;return r=r||n,s.count=t,0===t?e():s;function s(t,n){if(s.count<=0)throw new Error("after called too many times");--s.count,t?(i=!0,e(t),e=r):0!==s.count||i||e(null,n)}}},function(t,e){t.exports=function(t,e,n){var r=t.byteLength;if(e=e||0,n=n||r,t.slice)return t.slice(e,n);if(e<0&&(e+=r),n<0&&(n+=r),n>r&&(n=r),e>=r||e>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(t),s=new Uint8Array(n-e),o=e,a=0;o<n;o++,a++)s[a]=i[o];return s.buffer}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}},function(t,e,n){(function(e){var r=n(21),i=n(36),s=n(10),o=n(15),a=n(1)("engine.io-client:polling-xhr");function c(){}function h(t){if(i.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,e.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=t.hostname!==e.location.hostname||r!==t.port,this.xs=t.secure!==n}}function u(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function l(){for(var t in u.requests)u.requests.hasOwnProperty(t)&&u.requests[t].abort()}t.exports=h,t.exports.Request=u,o(h,i),h.prototype.supportsBinary=!0,h.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new u(t)},h.prototype.doWrite=function(t,e){var n="string"!=typeof t&&void 0!==t,r=this.request({method:"POST",data:t,isBinary:n}),i=this;r.on("success",e),r.on("error",function(t){i.onError("xhr post error",t)}),this.sendXhr=r},h.prototype.doPoll=function(){a("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},s(u.prototype),u.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new r(t),i=this;try{a("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var s in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this.extraHeaders[s])}catch(t){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{n.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){i.onLoad()},n.onerror=function(){i.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var t=n.getResponseHeader("Content-Type");i.supportsBinary&&"application/octet-stream"===t&&(n.responseType="arraybuffer")}catch(t){}4===n.readyState&&(200===n.status||1223===n.status?i.onLoad():setTimeout(function(){i.onError(n.status)},0))},a("xhr data %s",this.data),n.send(this.data)}catch(t){return void setTimeout(function(){i.onError(t)},0)}e.document&&(this.index=u.requestsCount++,u.requests[this.index]=this)},u.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},u.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},u.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},u.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,t)try{this.xhr.abort()}catch(t){}e.document&&delete u.requests[this.index],this.xhr=null}},u.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},u.prototype.hasXDR=function(){return void 0!==e.XDomainRequest&&!this.xs&&this.enablesXDR},u.prototype.abort=function(){this.cleanup()},u.requestsCount=0,u.requests={},e.document&&(e.attachEvent?e.attachEvent("onunload",l):e.addEventListener&&e.addEventListener("beforeunload",l,!1))}).call(this,n(0))},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,n){(function(e){var r=n(37),i=n(10),s=n(1)("engine.io-client:socket"),o=n(33),a=n(9),c=n(41),h=n(16);function u(t,n){if(!(this instanceof u))return new u(t,n);n=n||{},t&&"object"==typeof t&&(n=t,t=null),t?(t=c(t),n.hostname=t.host,n.secure="https"===t.protocol||"wss"===t.protocol,n.port=t.port,t.query&&(n.query=t.query)):n.host&&(n.hostname=c(n.host).host),this.secure=null!=n.secure?n.secure:e.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(e.location?location.hostname:"localhost"),this.port=n.port||(e.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=h.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode;var r="object"==typeof e&&e;r.global===r&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=u,u.priorWebsocketSuccess=!1,i(u.prototype),u.protocol=a.protocol,u.Socket=u,u.Transport=n(20),u.transports=n(37),u.parser=n(9),u.prototype.createTransport=function(t){s('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=a.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new r[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},u.prototype.open=function(){var t;if(this.rememberUpgrade&&u.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},u.prototype.setTransport=function(t){s("setting transport %s",t.name);var e=this;this.transport&&(s("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},u.prototype.probe=function(t){s('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(s('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(s('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;u.priorWebsocketSuccess="websocket"===e.name,s('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(s("changing transport and sending upgrade packet"),f(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())})}else{s('probe transport "%s" failed',t);var o=new Error("probe error");o.transport=e.name,r.emit("upgradeError",o)}}))}function o(){n||(n=!0,f(),e.close(),e=null)}function a(n){var i=new Error("probe error: "+n);i.transport=e.name,o(),s('probe transport "%s" failed because of error: %s',t,n),r.emit("upgradeError",i)}function c(){a("transport closed")}function h(){a("socket closed")}function l(t){e&&t.name!==e.name&&(s('"%s" works - aborting "%s"',t.name,e.name),o())}function f(){e.removeListener("open",i),e.removeListener("error",a),e.removeListener("close",c),r.removeListener("close",h),r.removeListener("upgrading",l)}u.priorWebsocketSuccess=!1,e.once("open",i),e.once("error",a),e.once("close",c),this.once("close",h),this.once("upgrading",l),e.open()},u.prototype.onOpen=function(){if(s("socket open"),this.readyState="open",u.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){s("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},u.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(s('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else s('packet received with socket readyState "%s"',this.readyState)},u.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},u.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},u.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){s("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},u.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},u.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},u.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(s("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},u.prototype.write=u.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},u.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:t,data:e,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},u.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}function e(){t.onClose("forced close"),s("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this},u.prototype.onError=function(t){s("socket error %j",t),u.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},u.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(s('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},u.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;n<r;n++)~o(this.transports,t[n])&&e.push(t[n]);return e}}).call(this,n(0))},function(t,e,n){t.exports=n(121),t.exports.parser=n(9)},function(t,e,n){(function(t){var r=n(40),i=n(39),s=Object.prototype.toString,o="function"==typeof t.Blob||"[object BlobConstructor]"===s.call(t.Blob),a="function"==typeof t.File||"[object FileConstructor]"===s.call(t.File);e.deconstructPacket=function(t){var e=[],n=t.data,s=t;return s.data=function t(e,n){if(!e)return e;if(i(e)){var s={_placeholder:!0,num:n.length};return n.push(e),s}if(r(e)){for(var o=new Array(e.length),a=0;a<e.length;a++)o[a]=t(e[a],n);return o}if("object"==typeof e&&!(e instanceof Date)){o={};for(var c in e)o[c]=t(e[c],n);return o}return e}(n,e),s.attachments=e.length,{packet:s,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(r(e))for(var i=0;i<e.length;i++)e[i]=t(e[i],n);else if("object"==typeof e)for(var s in e)e[s]=t(e[s],n);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var n=0,s=t;!function t(c,h,u){if(!c)return c;if(o&&c instanceof Blob||a&&c instanceof File){n++;var l=new FileReader;l.onload=function(){u?u[h]=this.result:s=this.result,--n||e(s)},l.readAsArrayBuffer(c)}else if(r(c))for(var f=0;f<c.length;f++)t(c[f],f,c);else if("object"==typeof c&&!i(c))for(var p in c)t(c[p],p,c)}(s),n||e(s)}}).call(this,n(0))},function(t,e,n){(function(e){var r=n(41),i=n(1)("socket.io-client:url");t.exports=function(t,n){var s=t;n=n||e.location,null==t&&(t=n.protocol+"//"+n.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(i("protocol-less url %s",t),t=void 0!==n?n.protocol+"//"+t:"https://"+t),i("parse %s",t),s=r(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";var o=-1!==s.host.indexOf(":")?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port,s.href=s.protocol+"://"+o+(n&&n.port===s.port?"":":"+s.port),s}}).call(this,n(0))},function(t,e,n){"use strict";const r=n(24),i=n(43);t.exports=class{constructor(t,e,n){this._network=t,this._protocol=n,this._signaling=new i(t,e),this._communication=new r(t,n)}get protocol(){return this._protocol}get network(){return this._network}get signaling(){return this._signaling}get communication(){return this._communication}use(t,e=0){this.communication.use(t,e)}}},function(t,e,n){"use strict";const r=n(3),i=n(2),s=n(125),o=n(29),a=n(28),c=n(1)("foglet-core:network-manager");t.exports=class extends r{constructor(t){super(),this._options=i({rps:{type:"spray-wrtc",options:{protocol:"spray-wrtc-communication"}},overlays:[]},t),this._rps=this._buildRPS(this._options.rps.type,this._options.rps.options),this._overlays=new Map,this._buildOverlays(this._options.overlays),c("Networks (Rps and overlays) initialized.")}overlay(t=null){return null===t?this._rps:this._overlays.get(t)}registerMiddleware(t,e=0){this._rps.use(t,e),this._overlays.forEach(n=>n.use(t,e))}_buildRPS(t,e){const n=new(this._chooseRps(t,e))(e);return new s(n,e.signaling,e.protocol)}_chooseRps(t,e){let n=null;switch(t){case"spray-wrtc":n=o;break;case"cyclon":n=a;break;case"custom":n=e.class;break;default:n=o}return n}_buildOverlays(t){0===t.length&&c("No overlays added, only the base RPS is available"),t.forEach(t=>{this._buildOverlay(t)})}_buildOverlay(t){if(!("object"==typeof t&&"name"in t&&"class"in t))throw new SyntaxError("An overlay is a configuration object {name: [string], class: [function], options: [Object]}");const e=t.options;if(!("protocol"in e))throw new SyntaxError("An overlay configuration requires a protocol name, e;g. { protocol: [string] }");if("signaling"in e||c(`[WARNING] no signaling server given for overlay "${t.name}"! Only connections from inside the same app will be allowed!`),this._overlays.has(t.name))throw new Error(`An overlay with the name "${t.name}" has already been registered!`);const n=new t.class(this,e);this._overlays.set(t.name,new s(n,e.signaling,e.protocol))}}},function(t,e,n){t.exports=n(6).PassThrough},function(t,e,n){t.exports=n(6).Transform},function(t,e,n){t.exports=n(8)},function(t,e,n){t.exports=n(23)},function(t,e,n){t.exports=i;var r=n(3).EventEmitter;function i(){r.call(this)}n(5)(i,r),i.Readable=n(6),i.Writable=n(130),i.Duplex=n(129),i.Transform=n(128),i.PassThrough=n(127),i.Stream=i,i.prototype.pipe=function(t,e){var n=this;function i(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function s(){n.readable&&n.resume&&n.resume()}n.on("data",i),t.on("drain",s),t._isStdio||e&&!1===e.end||(n.on("end",a),n.on("close",c));var o=!1;function a(){o||(o=!0,t.end())}function c(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function h(t){if(u(),0===r.listenerCount(this,"error"))throw t}function u(){n.removeListener("data",i),t.removeListener("drain",s),n.removeListener("end",a),n.removeListener("close",c),n.removeListener("error",h),t.removeListener("error",h),n.removeListener("end",u),n.removeListener("close",u),t.removeListener("close",u)}return n.on("error",h),t.on("error",h),n.on("end",u),n.on("close",u),t.on("close",u),t.emit("pipe",n),t}},function(t,e,n){var r=n(11).Buffer;t.exports=function(t){if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if("function"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(r.isBuffer(t)){for(var e=new Uint8Array(t.length),n=t.length,i=0;i<n;i++)e[i]=t[i];return e.buffer}throw new Error("Argument must be a Buffer")}},function(t,e,n){t.exports=c;var r=n(5),i=n(6),s=n(132),o="undefined"!=typeof window&&window.MediaSource,a=60;function c(t,e){var n=this;if(!(n instanceof c))return new c(t,e);if(!o)throw new Error("web browser lacks MediaSource support");e||(e={}),n._debug=e.debug,n._bufferDuration=e.bufferDuration||a,n._elem=t,n._mediaSource=new o,n._streams=[],n.detailedError=null,n._errorHandler=function(){n._elem.removeEventListener("error",n._errorHandler),n._streams.slice().forEach(function(t){t.destroy(n._elem.error)})},n._elem.addEventListener("error",n._errorHandler),n._elem.src=window.URL.createObjectURL(n._mediaSource)}function h(t,e){var n=this;if(i.Writable.call(n),n._wrapper=t,n._elem=t._elem,n._mediaSource=t._mediaSource,n._allStreams=t._streams,n._allStreams.push(n),n._bufferDuration=t._bufferDuration,n._sourceBuffer=null,n._debugBuffers=[],n._openHandler=function(){n._onSourceOpen()},n._flowHandler=function(){n._flow()},n._errorHandler=function(t){n.destroyed||n.emit("error",t)},"string"==typeof e)n._type=e,"open"===n._mediaSource.readyState?n._createSourceBuffer():n._mediaSource.addEventListener("sourceopen",n._openHandler);else if(null===e._sourceBuffer)e.destroy(),n._type=e._type,n._mediaSource.addEventListener("sourceopen",n._openHandler);else{if(!e._sourceBuffer)throw new Error("The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function");e.destroy(),n._type=e._type,n._sourceBuffer=e._sourceBuffer,n._debugBuffers=e._debugBuffers,n._sourceBuffer.addEventListener("updateend",n._flowHandler),n._sourceBuffer.addEventListener("error",n._errorHandler)}n._elem.addEventListener("timeupdate",n._flowHandler),n.on("error",function(t){n._wrapper.error(t)}),n.on("finish",function(){if(!n.destroyed&&(n._finished=!0,n._allStreams.every(function(t){return t._finished}))){n._wrapper._dumpDebugData();try{n._mediaSource.endOfStream()}catch(t){}}})}c.prototype.createWriteStream=function(t){return new h(this,t)},c.prototype.error=function(t){this.detailedError||(this.detailedError=t),this._dumpDebugData();try{this._mediaSource.endOfStream("decode")}catch(t){}},c.prototype._dumpDebugData=function(){this._debug&&(this._debug=!1,this._streams.forEach(function(t,e){var n,r,i;n=t._debugBuffers,r="mediasource-stream-"+e,(i=document.createElement("a")).href=window.URL.createObjectURL(new window.Blob(n)),i.download=r,i.click()}))},r(h,i.Writable),h.prototype._onSourceOpen=function(){this.destroyed||(this._mediaSource.removeEventListener("sourceopen",this._openHandler),this._createSourceBuffer())},h.prototype.destroy=function(t){this.destroyed||(this.destroyed=!0,this._allStreams.splice(this._allStreams.indexOf(this),1),this._mediaSource.removeEventListener("sourceopen",this._openHandler),this._elem.removeEventListener("timeupdate",this._flowHandler),this._sourceBuffer&&(this._sourceBuffer.removeEventListener("updateend",this._flowHandler),this._sourceBuffer.removeEventListener("error",this._errorHandler),"open"===this._mediaSource.readyState&&this._sourceBuffer.abort()),t&&this.emit("error",t),this.emit("close"))},h.prototype._createSourceBuffer=function(){if(!this.destroyed)if(o.isTypeSupported(this._type)){if(this._sourceBuffer=this._mediaSource.addSourceBuffer(this._type),this._sourceBuffer.addEventListener("updateend",this._flowHandler),this._sourceBuffer.addEventListener("error",this._errorHandler),this._cb){var t=this._cb;this._cb=null,t()}}else this.destroy(new Error("The provided type is not supported"))},h.prototype._write=function(t,e,n){var r=this;if(!r.destroyed)if(r._sourceBuffer){if(r._sourceBuffer.updating)return n(new Error("Cannot append buffer while source buffer updating"));var i=s(t);r._wrapper._debug&&r._debugBuffers.push(i);try{r._sourceBuffer.appendBuffer(i)}catch(t){return void r.destroy(t)}r._cb=n}else r._cb=function(i){if(i)return n(i);r._write(t,e,n)}},h.prototype._flow=function(){if(!this.destroyed&&this._sourceBuffer&&!this._sourceBuffer.updating&&!("open"===this._mediaSource.readyState&&this._getBufferDuration()>this._bufferDuration)&&this._cb){var t=this._cb;this._cb=null,t()}},h.prototype._getBufferDuration=function(){for(var t=this._sourceBuffer.buffered,e=this._elem.currentTime,n=-1,r=0;r<t.length;r++){var i=t.start(r),s=t.end(r)+0;if(i>e)break;(n>=0||e<=s)&&(n=s)}var o=n-e;return o<0&&(o=0),o}},function(t,e,n){(function(e){var r=n(6);function i(){}t.exports=function(t,n){n||(n={});var s=r.Readable(),o=0,a=0,c=[];return s.recorder=null,s.media=null,s._read=i,s.destroyed=!1,s.destroy=function(t){s.destroyed||(s.destroyed=!0,s.recorder&&s.recorder.stop(),t&&s.emit("error",t),s.emit("close"),s.recorder=null,s.media=null)},s.stop=function(){s.once("data",function(){s.push(null)}),s.recorder.stop()},s.media=t,s.recorder=new window.MediaRecorder(t,n),s.recorder.addEventListener("dataavailable",function(t){var n,r,i;n=t.data,r=new window.FileReader,i=o++,r.addEventListener("loadend",function(){for(var t=e(new Uint8Array(r.result)),n=i-a;c.length<n;)c.push(null);for(c[n]=t;c.length&&c[0];){var o=c.shift();a++,s.push(o)}}),r.readAsArrayBuffer(n)}),s.recorder.start(n.interval||1e3),s}}).call(this,n(11).Buffer)},function(t,e,n){"use strict";const r=n(6).PassThrough;t.exports=class extends r{constructor(){super({objectMode:!0}),this._trailers=null}get trailers(){return this._trailers}}},function(t,e,n){"use strict";const r=t=>(e,n)=>({id:e,type:t,payload:n}),i=r("chunk"),s=r("trailers"),o=r("end"),a=r("error");t.exports={StreamMessageChunk:i,StreamMessageTrailers:s,StreamMessageEnd:o,StreamMessageError:a}},function(t,e,n){"use strict";t.exports=s;var r=n(44),i=n(13);function s(t){if(!(this instanceof s))return new s(t);r.call(this,t)}i.inherits=n(5),i.inherits(s,r),s.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){(function(e){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(t,e){if(n("noDeprecation"))return t;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}).call(this,n(0))},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i,s,o,a,c=1,h={},u=!1,l=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?r=function(t){e.nextTick(function(){d(t)})}:function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?(o="setImmediate$"+Math.random()+"$",a=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(o)&&d(+e.data.slice(o.length))},t.addEventListener?t.addEventListener("message",a,!1):t.attachEvent("onmessage",a),r=function(e){t.postMessage(o+e,"*")}):t.MessageChannel?((s=new MessageChannel).port1.onmessage=function(t){d(t.data)},r=function(t){s.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,r=function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):r=function(t){setTimeout(d,0,t)},f.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return h[c]=i,r(c),c++},f.clearImmediate=p}function p(t){delete h[t]}function d(t){if(u)setTimeout(d,0,t);else{var e=h[t];if(e){u=!0;try{!function(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{p(t),u=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(0),n(7))},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function s(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new s(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new s(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(139),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(t,e){},function(t,e,n){"use strict";var r=n(14).Buffer,i=n(141);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},t.prototype.concat=function(t){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var e,n,i=r.allocUnsafe(t>>>0),s=this.head,o=0;s;)e=i,n=o,s.data.copy(e,n),o+=s.data.length,s=s.next;return i},t}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e){e.read=function(t,e,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,h=c>>1,u=-7,l=n?i-1:0,f=n?-1:1,p=t[e+l];for(l+=f,s=p&(1<<-u)-1,p>>=-u,u+=a;u>0;s=256*s+t[e+l],l+=f,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+l],l+=f,u-=8);if(0===s)s=1-h;else{if(s===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),s-=h}return(p?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,a,c,h=8*s-i-1,u=(1<<h)-1,l=u>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,d=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),(e+=o+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(o++,c/=2),o+l>=u?(a=0,o=u):o+l>=1?(a=(e*c-1)*Math.pow(2,i),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),o=0));i>=8;t[n+p]=255&a,p+=d,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;t[n+p]=255&o,p+=d,o/=256,h-=8);t[n+p-d]|=128*g}},function(t,e,n){"use strict";e.byteLength=function(t){var e=h(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){for(var e,n=h(t),r=n[0],o=n[1],a=new s(3*(r+o)/4-o),c=0,u=o>0?r-4:r,l=0;l<u;l+=4)e=i[t.charCodeAt(l)]<<18|i[t.charCodeAt(l+1)]<<12|i[t.charCodeAt(l+2)]<<6|i[t.charCodeAt(l+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=255&e;return 2===o&&(e=i[t.charCodeAt(l)]<<2|i[t.charCodeAt(l+1)]>>4,a[c++]=255&e),1===o&&(e=i[t.charCodeAt(l)]<<10|i[t.charCodeAt(l+1)]<<4|i[t.charCodeAt(l+2)]>>2,a[c++]=e>>8&255,a[c++]=255&e),a},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(u(t,o,o+16383>a?a:o+16383));return 1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function u(t,e,n){for(var i,s,o=[],a=e;a<n;a+=3)i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e,n){"use strict";const r=n(4),i=n(6).Writable,s=n(136);t.exports=class extends i{constructor(t){super({objectMode:!0}),this._id=r(),this._send=t,this._trailers=[],this._last_id=void 0}addTrailer(t){this._trailers.push(t)}destroy(t){this._last_id=this._send(s.StreamMessageError(this._id,t),null,this._last_id),super.destroy(t)}_write(t,e,n){return this._last_id=this._send(s.StreamMessageChunk(this._id,t),null,this._last_id),n(),this._last_id}_final(t){this._trailers.length>0&&(this._last_id=this._send(s.StreamMessageTrailers(this._id,this._trailers),null,this._last_id)),this._last_id=this._send(s.StreamMessageEnd(this._id),null,this._last_id),t()}}},function(t,e,n){"use strict";t.exports=class{constructor(){this._middlewares=[]}register(t,e=0){if(!("in"in t||"out"in t))throw new Error('A middleware must contains two functions: "in" and "out"');this._middlewares.push({middleware:t,priority:e}),this._middlewares.sort((t,e)=>t.priority-e.priority)}in(t){let e;return this._middlewares.reduce((t,n)=>void 0!==(e=n.middleware.in(t))||null!==e?e:t,t)}out(t){let e;return this._middlewares.reduce((t,n)=>void 0!==(e=n.middleware.out(t))||null!==e?e:t,t)}}},function(t,e){var n=1e3,r=6e4,i=36e5,s=24*i;function o(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var a,c=typeof t;if("string"===c&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(t);if("number"===c&&!1===isNaN(t))return e.long?o(a=t,s,"day")||o(a,i,"hour")||o(a,r,"minute")||o(a,n,"second")||a+" ms":function(t){return t>=s?Math.round(t/s)+"d":t>=i?Math.round(t/i)+"h":t>=r?Math.round(t/r)+"m":t>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){function r(t){var n;function r(){if(r.enabled){var t=r,i=+new Date,s=i-(n||i);t.diff=s,t.prev=n,t.curr=i,n=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=e.formatters[r];if("function"==typeof i){var s=o[c];n=i.call(t,s),o.splice(c,1),c--}return n}),e.formatArgs.call(t,o),(r.log||e.log||console.log.bind(console)).apply(t,o)}}return r.namespace=t,r.enabled=e.enabled(t),r.useColors=e.useColors(),r.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),r.destroy=i,"function"==typeof e.init&&e.init(r),e.instances.push(r),r}function i(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=r.debug=r.default=r).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(n=0;n<e.instances.length;n++){var s=e.instances[n];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(148),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e,n){(function(t,n){var r="Expected a function",i="__lodash_hash_undefined__",s=1,o=2,a=1/0,c=9007199254740991,h="[object Arguments]",u="[object Array]",l="[object Boolean]",f="[object Date]",p="[object Error]",d="[object Function]",g="[object GeneratorFunction]",y="[object Map]",m="[object Number]",v="[object Object]",_="[object RegExp]",w="[object Set]",b="[object String]",E="[object Symbol]",k="[object ArrayBuffer]",S="[object DataView]",x=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,A=/^\w*$/,R=/^\./,C=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,T=/\\(\\)?/g,P=/^\[object .+?Constructor\]$/,M=/^(?:0|[1-9]\d*)$/,I={};I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I[h]=I[u]=I[k]=I[l]=I[S]=I[f]=I[p]=I[d]=I[y]=I[m]=I[v]=I[_]=I[w]=I[b]=I["[object WeakMap]"]=!1;var B="object"==typeof t&&t&&t.Object===Object&&t,O="object"==typeof self&&self&&self.Object===Object&&self,j=B||O||Function("return this")(),N="object"==typeof e&&e&&!e.nodeType&&e,D=N&&"object"==typeof n&&n&&!n.nodeType&&n,L=D&&D.exports===N&&B.process,U=function(){try{return L&&L.binding("util")}catch(t){}}(),F=U&&U.isTypedArray;function q(t,e){for(var n=-1,r=t?t.length:0;++n<r;)if(e(t[n],n,t))return!0;return!1}function z(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}function V(t){var e=-1,n=Array(t.size);return t.forEach(function(t,r){n[++e]=[r,t]}),n}function W(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var H,$,Y,X=Array.prototype,J=Function.prototype,G=Object.prototype,K=j["__core-js_shared__"],Q=(H=/[^.]+$/.exec(K&&K.keys&&K.keys.IE_PROTO||""))?"Symbol(src)_1."+H:"",Z=J.toString,tt=G.hasOwnProperty,et=G.toString,nt=RegExp("^"+Z.call(tt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),rt=j.Symbol,it=j.Uint8Array,st=G.propertyIsEnumerable,ot=X.splice,at=Math.floor,ct=($=Object.keys,Y=Object,function(t){return $(Y(t))}),ht=Math.min,ut=Nt(j,"DataView"),lt=Nt(j,"Map"),ft=Nt(j,"Promise"),pt=Nt(j,"Set"),dt=Nt(j,"WeakMap"),gt=Nt(Object,"create"),yt=Wt(ut),mt=Wt(lt),vt=Wt(ft),_t=Wt(pt),wt=Wt(dt),bt=rt?rt.prototype:void 0,Et=bt?bt.valueOf:void 0,kt=bt?bt.toString:void 0;function St(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xt(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function At(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Rt(t){var e=-1,n=t?t.length:0;for(this.__data__=new At;++e<n;)this.add(t[e])}function Ct(t){this.__data__=new xt(t)}function Tt(t,e){for(var n=t.length;n--;)if($t(t[n][0],e))return n;return-1}function Pt(t,e){for(var n=0,r=(e=Ut(e,t)?[e]:Bt(e)).length;null!=t&&n<r;)t=t[Vt(e[n++])];return n&&n==r?t:void 0}function Mt(t,e){return null!=t&&e in Object(t)}function It(t,e,n,r,i){return t===e||(null==t||null==e||!Qt(t)&&!Zt(e)?t!=t&&e!=e:function(t,e,n,r,i,a){var c=Xt(t),d=Xt(e),g=u,x=u;c||(g=(g=Dt(t))==h?v:g),d||(x=(x=Dt(e))==h?v:x);var A=g==v&&!z(t),R=x==v&&!z(e),C=g==x;if(C&&!A)return a||(a=new Ct),c||ee(t)?Ot(t,e,n,r,i,a):function(t,e,n,r,i,a,c){switch(n){case S:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case k:return!(t.byteLength!=e.byteLength||!r(new it(t),new it(e)));case l:case f:case m:return $t(+t,+e);case p:return t.name==e.name&&t.message==e.message;case _:case b:return t==e+"";case y:var h=V;case w:var u=a&o;if(h||(h=W),t.size!=e.size&&!u)return!1;var d=c.get(t);if(d)return d==e;a|=s,c.set(t,e);var g=Ot(h(t),h(e),r,i,a,c);return c.delete(t),g;case E:if(Et)return Et.call(t)==Et.call(e)}return!1}(t,e,g,n,r,i,a);if(!(i&o)){var T=A&&tt.call(t,"__wrapped__"),P=R&&tt.call(e,"__wrapped__");if(T||P){var M=T?t.value():t,I=P?e.value():e;return a||(a=new Ct),n(M,I,r,i,a)}}return!!C&&(a||(a=new Ct),function(t,e,n,r,i,s){var a=i&o,c=ne(t),h=c.length;if(h!=ne(e).length&&!a)return!1;for(var u=h;u--;){var l=c[u];if(!(a?l in e:tt.call(e,l)))return!1}var f=s.get(t);if(f&&s.get(e))return f==e;var p=!0;s.set(t,e),s.set(e,t);for(var d=a;++u<h;){var g=t[l=c[u]],y=e[l];if(r)var m=a?r(y,g,l,e,t,s):r(g,y,l,t,e,s);if(!(void 0===m?g===y||n(g,y,r,i,s):m)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var v=t.constructor,_=e.constructor;v!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof v&&v instanceof v&&"function"==typeof _&&_ instanceof _)&&(p=!1)}return s.delete(t),s.delete(e),p}(t,e,n,r,i,a))}(t,e,It,n,r,i))}function Bt(t){return Xt(t)?t:zt(t)}function Ot(t,e,n,r,i,a){var c=i&o,h=t.length,u=e.length;if(h!=u&&!(c&&u>h))return!1;var l=a.get(t);if(l&&a.get(e))return l==e;var f=-1,p=!0,d=i&s?new Rt:void 0;for(a.set(t,e),a.set(e,t);++f<h;){var g=t[f],y=e[f];if(r)var m=c?r(y,g,f,e,t,a):r(g,y,f,t,e,a);if(void 0!==m){if(m)continue;p=!1;break}if(d){if(!q(e,function(t,e){if(!d.has(e)&&(g===t||n(g,t,r,i,a)))return d.add(e)})){p=!1;break}}else if(g!==y&&!n(g,y,r,i,a)){p=!1;break}}return a.delete(t),a.delete(e),p}function jt(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Nt(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!Qt(t)||Q&&Q in t)&&(Gt(t)||z(t)?nt:P).test(Wt(t))}(n)?n:void 0}St.prototype.clear=function(){this.__data__=gt?gt(null):{}},St.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},St.prototype.get=function(t){var e=this.__data__;if(gt){var n=e[t];return n===i?void 0:n}return tt.call(e,t)?e[t]:void 0},St.prototype.has=function(t){var e=this.__data__;return gt?void 0!==e[t]:tt.call(e,t)},St.prototype.set=function(t,e){return this.__data__[t]=gt&&void 0===e?i:e,this},xt.prototype.clear=function(){this.__data__=[]},xt.prototype.delete=function(t){var e=this.__data__,n=Tt(e,t);return!(n<0||(n==e.length-1?e.pop():ot.call(e,n,1),0))},xt.prototype.get=function(t){var e=this.__data__,n=Tt(e,t);return n<0?void 0:e[n][1]},xt.prototype.has=function(t){return Tt(this.__data__,t)>-1},xt.prototype.set=function(t,e){var n=this.__data__,r=Tt(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},At.prototype.clear=function(){this.__data__={hash:new St,map:new(lt||xt),string:new St}},At.prototype.delete=function(t){return jt(this,t).delete(t)},At.prototype.get=function(t){return jt(this,t).get(t)},At.prototype.has=function(t){return jt(this,t).has(t)},At.prototype.set=function(t,e){return jt(this,t).set(t,e),this},Rt.prototype.add=Rt.prototype.push=function(t){return this.__data__.set(t,i),this},Rt.prototype.has=function(t){return this.__data__.has(t)},Ct.prototype.clear=function(){this.__data__=new xt},Ct.prototype.delete=function(t){return this.__data__.delete(t)},Ct.prototype.get=function(t){return this.__data__.get(t)},Ct.prototype.has=function(t){return this.__data__.has(t)},Ct.prototype.set=function(t,e){var n=this.__data__;if(n instanceof xt){var r=n.__data__;if(!lt||r.length<199)return r.push([t,e]),this;n=this.__data__=new At(r)}return n.set(t,e),this};var Dt=function(t){return et.call(t)};function Lt(t,e){return!!(e=null==e?c:e)&&("number"==typeof t||M.test(t))&&t>-1&&t%1==0&&t<e}function Ut(t,e){if(Xt(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!te(t))||A.test(t)||!x.test(t)||null!=e&&t in Object(e)}function Ft(t){return t==t&&!Qt(t)}function qt(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}}(ut&&Dt(new ut(new ArrayBuffer(1)))!=S||lt&&Dt(new lt)!=y||ft&&"[object Promise]"!=Dt(ft.resolve())||pt&&Dt(new pt)!=w||dt&&"[object WeakMap]"!=Dt(new dt))&&(Dt=function(t){var e=et.call(t),n=e==v?t.constructor:void 0,r=n?Wt(n):void 0;if(r)switch(r){case yt:return S;case mt:return y;case vt:return"[object Promise]";case _t:return w;case wt:return"[object WeakMap]"}return e});var zt=Ht(function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(te(t))return kt?kt.call(t):"";var e=t+"";return"0"==e&&1/t==-a?"-0":e}(e);var n=[];return R.test(t)&&n.push(""),t.replace(C,function(t,e,r,i){n.push(r?i.replace(T,"$1"):e||t)}),n});function Vt(t){if("string"==typeof t||te(t))return t;var e=t+"";return"0"==e&&1/t==-a?"-0":e}function Wt(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Ht(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError(r);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o),o};return n.cache=new(Ht.Cache||At),n}function $t(t,e){return t===e||t!=t&&e!=e}function Yt(t){return function(t){return Zt(t)&&Jt(t)}(t)&&tt.call(t,"callee")&&(!st.call(t,"callee")||et.call(t)==h)}Ht.Cache=At;var Xt=Array.isArray;function Jt(t){return null!=t&&Kt(t.length)&&!Gt(t)}function Gt(t){var e=Qt(t)?et.call(t):"";return e==d||e==g}function Kt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=c}function Qt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Zt(t){return!!t&&"object"==typeof t}function te(t){return"symbol"==typeof t||Zt(t)&&et.call(t)==E}var ee=F?function(t){return function(e){return t(e)}}(F):function(t){return Zt(t)&&Kt(t.length)&&!!I[et.call(t)]};function ne(t){return Jt(t)?function(t,e){var n=Xt(t)||Yt(t)?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],r=n.length,i=!!r;for(var s in t)!e&&!tt.call(t,s)||i&&("length"==s||Lt(s,r))||n.push(s);return n}(t):function(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||G))return ct(t);var e,n,r=[];for(var i in Object(t))tt.call(t,i)&&"constructor"!=i&&r.push(i);return r}(t)}function re(t){return t}n.exports=function(t,e,n){return function(t,e,n,r){e=n(e);for(var i=0,s=t?t.length:0,o=e!=e,a=null===e,c=te(e),h=void 0===e;i<s;){var u=at((i+s)/2),l=n(t[u]),f=void 0!==l,p=null===l,d=l==l,g=te(l);if(o)var y=d;else y=h?d&&f:a?d&&f&&!p:c?d&&f&&!p&&!g:!p&&!g&&l<e;y?i=u+1:s=u}return ht(s,4294967294)}(t,e,function(t){return"function"==typeof t?t:null==t?re:"object"==typeof t?Xt(t)?function(t,e){return Ut(t)&&Ft(e)?qt(Vt(t),e):function(n){var r=function(t,e,n){var r=null==t?void 0:Pt(t,e);return void 0===r?void 0:r}(n,t);return void 0===r&&r===e?function(t,e){return null!=n&&function(t,e,n){for(var r,i=-1,s=(e=Ut(e,t)?[e]:Bt(e)).length;++i<s;){var o=Vt(e[i]);if(!(r=null!=t&&n(t,o)))break;t=t[o]}return r||!!(s=t?t.length:0)&&Kt(s)&&Lt(o,s)&&(Xt(t)||Yt(t))}(n,e,Mt)}(0,t):It(e,r,void 0,s|o)}}(t[0],t[1]):function(t){var e=function(t){for(var e=ne(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ft(i)]}return e}(t);return 1==e.length&&e[0][2]?qt(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,r){var i=n.length,a=i;if(null==t)return!a;for(t=Object(t);i--;){var c=n[i];if(c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++i<a;){var h=(c=n[i])[0],u=t[h],l=c[1];if(c[2]){if(void 0===u&&!(h in t))return!1}else{var f,p=new Ct;if(!(void 0===f?It(l,u,r,s|o,p):f))return!1}}return!0}(n,0,e)}}(t):Ut(e=t)?(n=Vt(e),function(t){return null==t?void 0:t[n]}):function(t){return function(e){return Pt(e,t)}}(e);var e,n}(n))}}).call(this,n(0),n(18)(t))},function(t,e,n){"use strict";t.exports={BroadcastMessage:function(t,e,n,r){return{protocol:t,id:e,isReady:n,payload:r}},MAntiEntropyRequest:function(t){return{type:"MAntiEntropyRequest",causality:t}},MAntiEntropyResponse:function(t,e,n,r){return{type:"MAntiEntropyResponse",id:t,causality:e,nbElements:n,element:r,elements:[]}}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e){this.e=t,this.c=e}}},function(t,e,n){"use strict";t.exports=class{constructor(t){this.e=t,this.v=0,this.x=[]}increment(){this.v+=1}incrementFrom(t){if(t<this.v){const e=this.x.indexOf(t);e>=0&&this.x.splice(e,1)}if(t===this.v+1&&(this.v+=1),t>this.v+1){for(let e=this.v+1;e<t;++e)this.x.push(e);this.v=t}}static comparator(t,e){const n=t.e||t,r=e.e||e;return n<r?-1:n>r?1:0}}},function(t,e){t.exports=function(t,e,n,r,i){var s,o;if(void 0===r)r=0;else if((r|=0)<0||r>=t.length)throw new RangeError("invalid lower bound");if(void 0===i)i=t.length-1;else if((i|=0)<r||i>=t.length)throw new RangeError("invalid upper bound");for(;r<=i;)if((o=+n(t[s=r+(i-r>>1)],e))<0)r=s+1;else{if(!(o>0))return s;i=s-1}return~r}},function(t,e,n){"use strict";t.exports=i;var r=n(154);function i(t,e){if("function"!=typeof t)throw new TypeError("comparator must be a function");this.arr=e||[],this.cmp=t}i.prototype.insert=function(t){var e=r(this.arr,t,this.cmp);e<0&&(e=~e),this.arr.splice(e,0,t)},i.prototype.indexOf=function(t){var e=r(this.arr,t,this.cmp);return e>=0?e:-1},i.prototype.remove=function(t){var e=r(this.arr,t,this.cmp);return!(e<0||(this.arr.splice(e,1),0))}},function(t,e,n){"use strict";const r=n(155),i=n(153),s=n(152);class o{constructor(t){this.local=new i(t),this.vector=new r(i.comparator),this.vector.insert(this.local)}clone(){const t=new o(this.local.e);for(let e=0;e<this.vector.arr.length;++e){t.vector.arr[e]=new i(this.vector.arr[e].e),t.vector.arr[e].v=this.vector.arr[e].v;for(let n=0;n<this.vector.arr[e].x.length;++n)t.vector.arr[e].x.push(this.vector.arr[e].x[n]);t.vector.arr[e].e===this.local.e&&(t.local=t.vector.arr[e])}return t}static fromJSON(t){const e=new o(t.local.e);for(let n=0;n<t.vector.arr.length;++n){e.vector.arr[n]=new i(t.vector.arr[n].e),e.vector.arr[n].v=t.vector.arr[n].v;for(let r=0;r<t.vector.arr[n].x.length;++r)e.vector.arr[n].x.push(t.vector.arr[n].x[r]);t.vector.arr[n].e===t.local.e&&(e.local=e.vector.arr[n])}return e}increment(){return this.local.increment(),new s(this.local.e,this.local.v)}incrementFrom(t){const e=this.vector.indexOf(t.e);e<0?(this.vector.insert(new i(t.e)),this.vector.arr[this.vector.indexOf(t.e)].incrementFrom(t.c)):this.vector.arr[e].incrementFrom(t.c)}isReady(t){if(void 0===t||null===t)return!0;const e=this.vector.indexOf(t.e);return e>=0&&t.c<=this.vector.arr[e].v&&this.vector.arr[e].x.indexOf(t.c)<0}isLower(t){return void 0!==t&&null!==t&&this.isReady(t)}merge(t){for(let e=0;e<t.vector.arr.length;++e){let n=t.vector.arr[e],r=this.vector.indexOf(n);if(r<0){let t=new i(n.e);t.v=n.v;for(let e=0;e<n.x.length;++e)t.x.push(n.x[e]);this.vector.insert(t)}else{let t=this.vector.arr[r],e=0;for(;e<t.x.length;)t.x[e]<n.v&&n.x.indexOf(t.x[e])<0?t.x.splice(e,1):++e;for(e=0;e<n.x.length;)n.x[e]>t.v&&t.x.indexOf(n.x[e])<0&&t.x.push(n.x[e]),++e;t.v=Math.max(t.v,n.v)}}}}t.exports=o},function(t,e,n){"use strict";const r=n(25),i=n(51);t.exports=class extends r{constructor(t,e){super(t,`foglet-broadcast-protocol-${e}`),this._unicast=new i(this._source,this._protocol),this._unicast.on("receive",(t,e)=>{this._receive(t,e)})}}},function(t,e,n){"use strict";const r=n(157),i=n(156),s=n(151),o=n(4),a=n(150),c=n(1)("foglet-core:broadcast");function h(t){return`e=${t.id.e}&c=${t.id.c}`}t.exports=class extends r{constructor(t,e){if(super(t,e),!t||!e)return new Error("Not enough parameters","fbroadcast.js");this.options={id:t._options.peer,delta:3e4},this._causality=new i(this.options.id),this._buffer=[],this._bufferAntiEntropy=s.MAntiEntropyResponse("init")}_sendAll(t){const e=this._source.getNeighbours(1/0);e.length>0&&e.forEach(e=>{this._unicast.send(e,t).catch(t=>{c(t)})})}send(t,e,n){const r=e||this._causality.increment(),i=s.BroadcastMessage(this._protocol,r,n,t);return this._causality.incrementFrom(r),this._sendAll(i),r}startAntiEntropy(t=this.options.delta){this._intervalAntiEntropy=setInterval(()=>{this._source.getNeighbours().forEach(t=>this._unicast.send(t,s.MAntiEntropyRequest(this._causality)))},t),this.on("antiEntropy",(t,e,n)=>this._defaultBehaviorAntiEntropy(t,e,n))}_defaultBehaviorAntiEntropy(t,e,n){c("(Warning) You should modify this, AntiEntropy default behavior: ",t,e,n)}clearAntiEntropy(){this._intervalAntiEntropy&&clearInterval(this._intervalAntiEntropy)}sendAntiEntropyResponse(t,e,n){let r=o(),i=this._unicast.send(t,s.MAntiEntropyResponse(r,e,n.length)),a=0;for(;i&&a<n.length;)i=this._unicast.send(t,s.MAntiEntropyResponse(r,null,n.length,n[a])),++a}_receive(t,e){switch("issuer"in e||(e.issuer=t),e.type){case"MAntiEntropyRequest":c(t,e),this.emit("antiEntropy",t,e.causality,this._causality.clone());break;case"MAntiEntropyResponse":if(this._bufferAntiEntropy.id!==e.id&&(this._bufferAntiEntropy=e),e.element&&this._bufferAntiEntropy.elements.push(e.element),e.causality&&(this._bufferAntiEntropy.causality=e.causality),this._bufferAntiEntropy.elements.length===this._bufferAntiEntropy.nbElements){for(let t=0;t<this._bufferAntiEntropy.elements.length;++t){let n=this._bufferAntiEntropy.elements[t];this._shouldStopPropagation(n)||(this._causality.incrementFrom(n.id),this.emit("receive",e.issuer,n.payload))}this._causality.merge(this._bufferAntiEntropy.causality)}break;default:if(!this._shouldStopPropagation(e)){const t=a(this._buffer,e,h);this._buffer.splice(t,0,e),this._reviewBuffer(),this._sendAll(e)}}}_shouldStopPropagation(t){return this._causality.isLower(t.id)||this._findInBuffer(h(t))>=0}_findInBuffer(t){let e,n,r=0,i=this._buffer.length-1;for(;r<=i;)if(e=(r+i)/2|0,(n=h(this._buffer[e]))<t)r=e+1;else{if(!(n>t))return e;i=e-1}return-1}_reviewBuffer(){let t,e=!1;for(let n=this._buffer.length-1;n>=0;--n)t=this._buffer[n],this._causality.isLower(t.id)?this._buffer.splice(n,1):this._causality.isReady(t.isReady)&&(e=!0,this._causality.incrementFrom(t.id),this._buffer.splice(n,1),this.emit("receive",t.issuer,t.payload));e&&this._reviewBuffer()}}},function(t,e,n){"use strict";t.exports=class{constructor(t,e,n){this.pid=t,this.event=e,this.args=n,this.type="MUnicast"}}},function(t,e){var n=1e3,r=6e4,i=36e5,s=24*i;function o(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}t.exports=function(t,e){e=e||{};var a,c=typeof t;if("string"===c&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var o=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"days":case"day":case"d":return o*s;case"hours":case"hour":case"hrs":case"hr":case"h":return o*i;case"minutes":case"minute":case"mins":case"min":case"m":return o*r;case"seconds":case"second":case"secs":case"sec":case"s":return o*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(t);if("number"===c&&!1===isNaN(t))return e.long?o(a=t,s,"day")||o(a,i,"hour")||o(a,r,"minute")||o(a,n,"second")||a+" ms":function(t){return t>=s?Math.round(t/s)+"d":t>=i?Math.round(t/i)+"h":t>=r?Math.round(t/r)+"m":t>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){var r;function i(t){function n(){if(n.enabled){var t=n,i=+new Date,s=i-(r||i);t.diff=s,t.prev=r,t.curr=i,r=i;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var c=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;c++;var i=e.formatters[r];if("function"==typeof i){var s=o[c];n=i.call(t,s),o.splice(c,1),c--}return n}),e.formatArgs.call(t,o),(n.log||e.log||console.log.bind(console)).apply(t,o)}}return n.namespace=t,n.enabled=e.enabled(t),n.useColors=e.useColors(),n.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),"function"==typeof e.init&&e.init(n),n}(e=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){e.save(t),e.names=[],e.skips=[];for(var n=("string"==typeof t?t:"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(t=n[i].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){var n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(160),e.names=[],e.skips=[],e.formatters={}},function(t,e,n){(function(r){function i(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==r&&"env"in r&&(t=r.env.DEBUG),t}(e=t.exports=n(161)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),n){var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var i=0,s=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&"%c"===t&&(s=++i)}),t.splice(s,0,r)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=i,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(i())}).call(this,n(7))},function(t,e,n){"use strict";const r=n(25);t.exports=class extends r{constructor(t,e){super(t,`foglet-unicast-protocol-${e}`)}}},function(t,e,n){const r=n(25),i=n(24),s=n(1)("foglet-core:media"),o=n(4),a=n(2),c=n(134),h=n(133),u=n(131);t.exports=class extends r{constructor(t,e,n){super(t,`foglet-media-internal-${e}`),this.options={retry:1,chunkSize:57344},this._activeMedia=new Map,this._activeStream=new Map,this._communication=new i(t,`foglet-media-internal-${e}`),this.NI=this._source.rps.NI,this.NO=this._source.rps.NO,this.i=this._source.rps.i,this.o=this._source.rps.o,this._source.rps.on("stream",(t,e)=>{this._receive(t,e)}),this._communication.onStreamBroadcast((t,e)=>{s("Receive a media stream: ",t,e),this._reconstruct(e)})}get pid(){return this._source.rps._pid()}sendUnicast(t,e){return e.id||(e.id=o()),this._activeMedia.has(e.id)||(this._activeMedia.set(e.id,e),this._setListeners(e)),this._send(t,e,this.options.retry)}sendBroadcast(t,e={}){e=a({mimeType:'video/webm; codecs="vp8"',interval:100,bitsPerSecond:131072},e),t.id||(t.id=o()),this._activeMedia.has(t.id)||(this._activeMedia.set(t.id,t),this._setListeners(t));const n=new c(t,e),r=this._communication.streamBroadcast();e.id=t.id,r.write(e),n.on("data",t=>{const e=this.chunkify(JSON.stringify(t));if(0===e.length)r.write({type:"full",id:0,payload:e[0]});else for(let t=0;t<e.length;t++)t===e.length-1?r.write({type:"end",id:t,payload:e[t]}):r.write({type:"chunk",id:t,payload:e[t]})}),n.on("end",()=>{r.end()})}_reconstruct(t,e=null){new class extends u.Readable{constructor(t,e,n){super(n),this.source=t,this.parent=e,this.objectMode=!0,this.count=0;let r="";this.source.on("data",t=>{0===this.count?(this.parent._activeStream.has(t.id)||this.parent._activeStream.set(t.id,{source:this,options:t}),this.parent.emit("receive",t.id),this.count++):"full"===t.type?(this.push(t.payload),this.count++):"end"===t.type?(r+=t.payload,this.push(new Uint8Array(JSON.parse(r).data)),this.count++,r=""):r+=t.payload}),this.source.on("end",()=>{this.end()})}_read(t){}}(t,this).on("error",t=>{console.error(t)})}getStreamMedia(t,e){if(!this._activeStream.has(t))return;const n=new h(e),r=n.createWriteStream(this._activeStream.get(t).options.mimeType);e.addEventListener("error",function(){var t=e.error,r=n.detailedError;console.error(t,r)}),r.on("error",function(t){console.error(t)}),this._activeStream.get(t).source.pipe(r)}_send(t,e,n=this.options.retry){return this.i.has(t)?this._sendBis(this.pid,t,e,n,this.NI):this.o.has(t)?this._sendBis(this.pid,t,e,n,this.NO):new Promise((r,i)=>{const s=o=>{this._sendBis(this.pid,t,e,n,this.NO).then(()=>{r()}).catch(a=>{this._sendBis(this.pid,t,e,n,this.NI).then(()=>{r()}).catch(t=>{o<n?setTimeout(()=>{s(o+1)},1e3):i(t)})})};s(0)})}_sendBis(t,e,n,r=0,i){return new Promise((o,a)=>{let c=null;i.living.contains(e)?c=i.living.get(e):i.dying.has(e)&&(c=i.dying.get(e));let h=u=>{try{c.socket.addStream(n),s("[%s][%s] --- MEDIA msg --\x3e %s:%s",t,i.PEER,e,t),o()}catch(n){s("[%s][%s] -X- MEDIA msg -X> %s:%s",t,i.PEER,e,t),u<r?setTimeout(()=>{h(u+1)},1e3):a(n)}};h(0)})}_receive(t,e){s("Receive a media stream: ",t,e),e.id||(e.id=o()),this._activeMedia.has(e.id)||(this._activeMedia.set(e.id,{peer:t,stream:e}),this._setListeners(e)),this.emit("receive",t,e)}_setListeners(t){t.onactive=(()=>{console.log("Media %s is active...",t.id)}),t.oninactive=(()=>{console.log("Media %s is inactive... (Disconnection or a Shuffling occured.)",t.id)}),t.onended=(()=>{console.log("Media %s is finished...",t.id)})}chunkify(t,e=this.options.chunkSize){return t.match(new RegExp(".{1,"+e+"}","g"))}}},function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function(t,e){var r=e||0,i=n;return i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+"-"+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]+i[t[r++]]}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function(){return n(r),r}}else{var i=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(t,e,n){"use strict";const r=n(3),i=n(4),s=n(2),o=n(164),a=n(126),c=n(76);t.exports=class extends r{constructor(t={}){super(),this._options=s({verbose:!0,rps:{type:"spray-wrtc",options:{protocol:"foglet-example-rps",webrtc:{trickle:!0,config:{iceServers:[]}},timeout:6e4,pendingTimeout:6e4,delta:6e4,maxPeers:5,a:1,b:5,signaling:{address:"https://signaling.herokuapp.com/",room:"best-room-for-foglet-rps"}}},overlays:[],ssh:void 0},t),this._options.id||(this._options.id=i()),this._options.rps.options.peer=this._options.id,this._id=this._options.id,this._networkManager=new a(this._options),this._options.ssh&&this._options.ssh.address&&(this._ssh=new c({foglet:this,address:this._options.ssh.address}))}get id(){return this._id}get inViewID(){return this.overlay().network.inviewId}get outViewID(){return this.overlay().network.outviewId}connection(t=null,e=null,n=this._options.pendingTimeout){return new Promise((r,i)=>{null!==t?this.overlay(e).signaling.connection(t.overlay(e).network,n).then(t=>{this.emit("connect"),r(t.connected)}).catch(t=>{i(t)}):this.overlay(e).signaling.connection(null,n).then(t=>{this.emit("connect"),r(t.connected)}).catch(t=>{i(t)})})}share(t=null){this.overlay(t).signaling.signaling()}unshare(t=null){this.overlay(t).signaling.unsignaling()}overlay(t=null){return this._networkManager.overlay(t)}use(t,e=0){this._networkManager.registerMiddleware(t,e)}onBroadcast(t){this.overlay().communication.onBroadcast(t)}onStreamBroadcast(t){this.overlay().communication.onStreamBroadcast(t)}sendBroadcast(t){return this.overlay().communication.sendBroadcast(t)}streamBroadcast(t){return this.overlay().communication.streamBroadcast(t)}onUnicast(t){this.overlay().communication.onUnicast(t)}onStreamUnicast(t){this.overlay().communication.onStreamUnicast(t)}sendUnicast(t,e){return this.overlay().communication.sendUnicast(t,e)}streamUnicast(t){return this.overlay().communication.streamUnicast(t)}sendMulticast(t=[],e){return this.overlay().communication.sendMulticast(t,e)}createMedia(t=null,e={}){return console.warn("[Warning] these methods are experimental."),new o(this.overlay(t).network,this.overlay(t).network.protocol,e)}getRandomNeighbourId(){const t=this.overlay().network.getNeighbours();if(0===t.length)return null;try{return t[Math.floor(Math.random()*t.length)]}catch(t){return console.error(t),null}}getNeighbours(t){return this.overlay().network.getNeighbours(t)}}},function(t,e,n){"use strict";const r=n(167),i=n(24),s=n(75),o=n(43),a=n(29),c=n(28),h=n(12),u=n(68),l=n(67),f=n(52);t.exports={Foglet:r,protocol:s,Signaling:o,SimplePeerMoc:f,networks:{Spray:a,Cyclon:c},communication:i,abstract:{rps:h,overlay:u,tman:l}}}])});
//# sourceMappingURL=foglet.bundle.min.js.map